"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _constants = require("../../../lib/constants");

var _protocolConverter = _interopRequireWildcard(require("../../../lib/jsonwp-proxy/protocol-converter"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const {
  MJSONWP,
  W3C
} = _constants.PROTOCOLS;
describe('Protocol Converter', function () {
  describe('getTimeoutRequestObjects', function () {
    let converter;
    before(function () {
      converter = new _protocolConverter.default(_lodash.default.noop);
    });
    it('should take W3C inputs and produce MJSONWP compatible objects', function () {
      converter.downstreamProtocol = MJSONWP;
      let timeoutObjects = converter.getTimeoutRequestObjects({
        script: 100
      });
      timeoutObjects.length.should.equal(1);
      timeoutObjects[0].should.eql({
        type: 'script',
        ms: 100
      });
    });
    it('should ignore invalid entries while converting from W3C', function () {
      converter.downstreamProtocol = MJSONWP;
      let timeoutObjects = converter.getTimeoutRequestObjects({
        script: 100,
        sessionId: '5432a4f3-cd89-4781-8905-ea9d3150840c',
        bar: -1,
        baz: undefined
      });
      timeoutObjects.length.should.equal(1);
      timeoutObjects[0].should.eql({
        type: 'script',
        ms: 100
      });
    });
    it('should take multiple W3C timeouts and produce multiple MJSONWP compatible objects', function () {
      converter.downstreamProtocol = MJSONWP;
      let [scriptTimeout, pageLoadTimeout, implicitTimeout] = converter.getTimeoutRequestObjects({
        script: 100,
        pageLoad: 200,
        implicit: 300
      });
      scriptTimeout.should.eql({
        type: 'script',
        ms: 100
      });
      pageLoadTimeout.should.eql({
        type: 'page load',
        ms: 200
      });
      implicitTimeout.should.eql({
        type: 'implicit',
        ms: 300
      });
    });
    it('should take MJSONWP input and produce W3C compatible object', function () {
      converter.downstreamProtocol = W3C;
      let timeoutObjects = converter.getTimeoutRequestObjects({
        type: 'implicit',
        ms: 300
      });
      timeoutObjects.length.should.equal(1);
      timeoutObjects[0].should.eql({
        implicit: 300
      });
    });
    it('should not change the input if protocol name is unknown', function () {
      converter.downstreamProtocol = null;
      let timeoutObjects = converter.getTimeoutRequestObjects({
        type: 'implicit',
        ms: 300
      });
      timeoutObjects.length.should.equal(1);
      timeoutObjects[0].should.eql({
        type: 'implicit',
        ms: 300
      });
    });
    it('should not change the input if protocol name is unchanged', function () {
      converter.downstreamProtocol = MJSONWP;
      let timeoutObjects = converter.getTimeoutRequestObjects({
        type: 'implicit',
        ms: 300
      });
      timeoutObjects.length.should.equal(1);
      timeoutObjects[0].should.eql({
        type: 'implicit',
        ms: 300
      });
    });
  });
  describe('setValue', function () {
    let converter;
    let responseBody;
    before(function () {
      responseBody = null;
      converter = new _protocolConverter.default((url, method, body) => {
        responseBody = body;
      });
    });
    beforeEach(function () {
      responseBody = {};
    });
    it('should calculate value if not present', async function () {
      await converter.proxySetValue('', '', {
        text: 'bla'
      });
      responseBody.should.eql({
        text: 'bla',
        value: ['b', 'l', 'a']
      });
    });
    it('should calculate text if not present', async function () {
      await converter.proxySetValue('', '', {
        value: ['b', 'l', 'a']
      });
      responseBody.should.eql({
        text: 'bla',
        value: ['b', 'l', 'a']
      });
    });
    it('should keep the response body unchanged if both value and text are present', async function () {
      await converter.proxySetValue('', '', {
        text: 'bla',
        value: ['b', 'l', 'a']
      });
      responseBody.should.eql({
        text: 'bla',
        value: ['b', 'l', 'a']
      });
    });
  });
  describe('getProperty', function () {
    let jsonwpConverter, w3cConverter;
    before(function () {
      for (let command of _protocolConverter.COMMAND_URLS_CONFLICTS) {
        if (command.commandNames.includes('getProperty')) {
          jsonwpConverter = command.jsonwpConverter;
          w3cConverter = command.w3cConverter;
        }
      }
    });
    it('should convert "property/value" to "attribute/value"', function () {
      jsonwpConverter('/session/123/element/456/property/value').should.equal('/session/123/element/456/attribute/value');
    });
    it('should convert "property/:somePropName" to "attribute/:somePropName"', function () {
      jsonwpConverter('/session/123/element/456/property/somePropName').should.equal('/session/123/element/456/attribute/somePropName');
    });
    it('should not convert from JSONWP to W3C', function () {
      w3cConverter('/session/123/element/456/attribute/someAttr').should.equal('/session/123/element/456/attribute/someAttr');
      w3cConverter('/session/123/element/456/property/someProp').should.equal('/session/123/element/456/property/someProp');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvdW5pdC9qc29ud3AtcHJveHkvcHJvdG9jb2wtY29udmVydGVyLnNwZWMuanMiXSwibmFtZXMiOlsiTUpTT05XUCIsIlczQyIsIlBST1RPQ09MUyIsImRlc2NyaWJlIiwiY29udmVydGVyIiwiYmVmb3JlIiwiUHJvdG9jb2xDb252ZXJ0ZXIiLCJfIiwibm9vcCIsIml0IiwiZG93bnN0cmVhbVByb3RvY29sIiwidGltZW91dE9iamVjdHMiLCJnZXRUaW1lb3V0UmVxdWVzdE9iamVjdHMiLCJzY3JpcHQiLCJsZW5ndGgiLCJzaG91bGQiLCJlcXVhbCIsImVxbCIsInR5cGUiLCJtcyIsInNlc3Npb25JZCIsImJhciIsImJheiIsInVuZGVmaW5lZCIsInNjcmlwdFRpbWVvdXQiLCJwYWdlTG9hZFRpbWVvdXQiLCJpbXBsaWNpdFRpbWVvdXQiLCJwYWdlTG9hZCIsImltcGxpY2l0IiwicmVzcG9uc2VCb2R5IiwidXJsIiwibWV0aG9kIiwiYm9keSIsImJlZm9yZUVhY2giLCJwcm94eVNldFZhbHVlIiwidGV4dCIsInZhbHVlIiwianNvbndwQ29udmVydGVyIiwidzNjQ29udmVydGVyIiwiY29tbWFuZCIsIkNPTU1BTkRfVVJMU19DT05GTElDVFMiLCJjb21tYW5kTmFtZXMiLCJpbmNsdWRlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLE1BQU07QUFBQ0EsRUFBQUEsT0FBRDtBQUFVQyxFQUFBQTtBQUFWLElBQWlCQyxvQkFBdkI7QUFHQUMsUUFBUSxDQUFDLG9CQUFELEVBQXVCLFlBQVk7QUFDekNBLEVBQUFBLFFBQVEsQ0FBQywwQkFBRCxFQUE2QixZQUFZO0FBQy9DLFFBQUlDLFNBQUo7QUFDQUMsSUFBQUEsTUFBTSxDQUFDLFlBQVk7QUFDakJELE1BQUFBLFNBQVMsR0FBRyxJQUFJRSwwQkFBSixDQUFzQkMsZ0JBQUVDLElBQXhCLENBQVo7QUFDRCxLQUZLLENBQU47QUFHQUMsSUFBQUEs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eUVDLEtBQXpFLENBQStFLGlEQUEvRTtBQUNELEtBRkMsQ0FBRjtBQUdBUCxJQUFBQSxFQUFFLENBQUMsdUNBQUQsRUFBMEMsWUFBWTtBQUN0RDZCLE1BQUFBLFlBQVksQ0FBQyw2Q0FBRCxDQUFaLENBQTREdkIsTUFBNUQsQ0FBbUVDLEtBQW5FLENBQXlFLDZDQUF6RTtBQUNBc0IsTUFBQUEsWUFBWSxDQUFDLDRDQUFELENBQVosQ0FBMkR2QixNQUEzRCxDQUFrRUMsS0FBbEUsQ0FBd0UsNENBQXhFO0FBQ0QsS0FIQyxDQUFGO0FBSUQsR0FwQk8sQ0FBUjtBQXFCRCxDQTFITyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IFBST1RPQ09MUyB9IGZyb20gJy4uLy4uLy4uL2xpYi9jb25zdGFudHMnO1xuaW1wb3J0IFByb3RvY29sQ29udmVydGVyLCB7Q09NTUFORF9VUkxTX0NPTkZMSUNUU30gZnJvbSAnLi4vLi4vLi4vbGliL2pzb253cC1wcm94eS9wcm90b2NvbC1jb252ZXJ0ZXInO1xuXG5jb25zdCB7TUpTT05XUCwgVzNDfSA9IFBST1RPQ09MUztcblxuXG5kZXNjcmliZSgnUHJvdG9jb2wgQ29udmVydGVyJywgZnVuY3Rpb24gKCkge1xuICBkZXNjcmliZSgnZ2V0VGltZW91dFJlcXVlc3RPYmplY3RzJywgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjb252ZXJ0ZXI7XG4gICAgYmVmb3JlKGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnZlcnRlciA9IG5ldyBQcm90b2NvbENvbnZlcnRlcihfLm5vb3ApO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGFrZSBXM0MgaW5wdXRzIGFuZCBwcm9kdWNlIE1KU09OV1AgY29tcGF0aWJsZSBvYmplY3RzJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29udmVydGVyLmRvd25zdHJlYW1Qcm90b2NvbCA9IE1KU09OV1A7XG4gICAgICBsZXQgdGltZW91dE9iamVjdHMgPSBjb252ZXJ0ZXIuZ2V0VGltZW91dFJlcXVlc3RPYmplY3RzKHtzY3JpcHQ6IDEwMH0pO1xuICAgICAgdGltZW91dE9iamVjdHMubGVuZ3RoLnNob3VsZC5lcXVhbCgxKTtcbiAgICAgIHRpbWVvdXRPYmplY3RzWzBdLnNob3VsZC5lcWwoe3R5cGU6ICdzY3JpcHQnLCBtczogMTAwfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBpZ25vcmUgaW52YWxpZCBlbnRyaWVzIHdoaWxlIGNvbnZlcnRpbmcgZnJvbSBXM0MnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb252ZXJ0ZXIuZG93bnN0cmVhbVByb3RvY29sID0gTUpTT05XUDtcbiAgICAgIGxldCB0aW1lb3V0T2JqZWN0cyA9IGNvbnZlcnRlci5nZXRUaW1lb3V0UmVxdWVzdE9iamVjdHMoe1xuICAgICAgICBzY3JpcHQ6IDEwMCxcbiAgICAgICAgc2Vzc2lvbklkOiAnNTQzMmE0ZjMtY2Q4OS00NzgxLTg5MDUtZWE5ZDMxNTA4NDBjJyxcbiAgICAgICAgYmFyOiAtMSxcbiAgICAgICAgYmF6OiB1bmRlZmluZWQsXG4gICAgICB9KTtcbiAgICAgIHRpbWVvdXRPYmplY3RzLmxlbmd0aC5zaG91bGQuZXF1YWwoMSk7XG4gICAgICB0aW1lb3V0T2JqZWN0c1swXS5zaG91bGQuZXFsKHt0eXBlOiAnc2NyaXB0JywgbXM6IDEwMH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGFrZSBtdWx0aXBsZSBXM0MgdGltZW91dHMgYW5kIHByb2R1Y2UgbXVsdGlwbGUgTUpTT05XUCBjb21wYXRpYmxlIG9iamVjdHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb252ZXJ0ZXIuZG93bnN0cmVhbVByb3RvY29sID0gTUpTT05XUDtcbiAgICAgIGxldCBbc2NyaXB0VGltZW91dCwgcGFnZUxvYWRUaW1lb3V0LCBpbXBsaWNpdFRpbWVvdXRdID0gY29udmVydGVyLmdldFRpbWVvdXRSZXF1ZXN0T2JqZWN0cyh7c2NyaXB0OiAxMDAsIHBhZ2VMb2FkOiAyMDAsIGltcGxpY2l0OiAzMDB9KTtcbiAgICAgIHNjcmlwdFRpbWVvdXQuc2hvdWxkLmVxbCh7XG4gICAgICAgIHR5cGU6ICdzY3JpcHQnLFxuICAgICAgICBtczogMTAwLFxuICAgICAgfSk7XG4gICAgICBwYWdlTG9hZFRpbWVvdXQuc2hvdWxkLmVxbCh7XG4gICAgICAgIHR5cGU6ICdwYWdlIGxvYWQnLFxuICAgICAgICBtczogMjAwLFxuICAgICAgfSk7XG4gICAgICBpbXBsaWNpdFRpbWVvdXQuc2hvdWxkLmVxbCh7XG4gICAgICAgIHR5cGU6ICdpbXBsaWNpdCcsXG4gICAgICAgIG1zOiAzMDAsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRha2UgTUpTT05XUCBpbnB1dCBhbmQgcHJvZHVjZSBXM0MgY29tcGF0aWJsZSBvYmplY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb252ZXJ0ZXIuZG93bnN0cmVhbVByb3RvY29sID0gVzNDO1xuICAgICAgbGV0IHRpbWVvdXRPYmplY3RzID0gY29udmVydGVyLmdldFRpbWVvdXRSZXF1ZXN0T2JqZWN0cyh7dHlwZTogJ2ltcGxpY2l0JywgbXM6IDMwMH0pO1xuICAgICAgdGltZW91dE9iamVjdHMubGVuZ3RoLnNob3VsZC5lcXVhbCgxKTtcbiAgICAgIHRpbWVvdXRPYmplY3RzWzBdLnNob3VsZC5lcWwoe2ltcGxpY2l0OiAzMDB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCBjaGFuZ2UgdGhlIGlucHV0IGlmIHByb3RvY29sIG5hbWUgaXMgdW5rbm93bicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnZlcnRlci5kb3duc3RyZWFtUHJvdG9jb2wgPSBudWxsO1xuICAgICAgbGV0IHRpbWVvdXRPYmplY3RzID0gY29udmVydGVyLmdldFRpbWVvdXRSZXF1ZXN0T2JqZWN0cyh7dHlwZTogJ2ltcGxpY2l0JywgbXM6IDMwMH0pO1xuICAgICAgdGltZW91dE9iamVjdHMubGVuZ3RoLnNob3VsZC5lcXVhbCgxKTtcbiAgICAgIHRpbWVvdXRPYmplY3RzWzBdLnNob3VsZC5lcWwoe3R5cGU6ICdpbXBsaWNpdCcsIG1zOiAzMDB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCBjaGFuZ2UgdGhlIGlucHV0IGlmIHByb3RvY29sIG5hbWUgaXMgdW5jaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29udmVydGVyLmRvd25zdHJlYW1Qcm90b2NvbCA9IE1KU09OV1A7XG4gICAgICBsZXQgdGltZW91dE9iamVjdHMgPSBjb252ZXJ0ZXIuZ2V0VGltZW91dFJlcXVlc3RPYmplY3RzKHt0eXBlOiAnaW1wbGljaXQnLCBtczogMzAwfSk7XG4gICAgICB0aW1lb3V0T2JqZWN0cy5sZW5ndGguc2hvdWxkLmVxdWFsKDEpO1xuICAgICAgdGltZW91dE9iamVjdHNbMF0uc2hvdWxkLmVxbCh7dHlwZTogJ2ltcGxpY2l0JywgbXM6IDMwMH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2V0VmFsdWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGNvbnZlcnRlcjtcbiAgICBsZXQgcmVzcG9uc2VCb2R5O1xuICAgIGJlZm9yZShmdW5jdGlvbiAoKSB7XG4gICAgICByZXNwb25zZUJvZHkgPSBudWxsO1xuICAgICAgY29udmVydGVyID0gbmV3IFByb3RvY29sQ29udmVydGVyKCh1cmwsIG1ldGhvZCwgYm9keSkgPT4ge1xuICAgICAgICByZXNwb25zZUJvZHkgPSBib2R5O1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICByZXNwb25zZUJvZHkgPSB7fTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHZhbHVlIGlmIG5vdCBwcmVzZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgY29udmVydGVyLnByb3h5U2V0VmFsdWUoJycsICcnLCB7XG4gICAgICAgIHRleHQ6ICdibGEnLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZUJvZHkuc2hvdWxkLmVxbCh7XG4gICAgICAgIHRleHQ6ICdibGEnLFxuICAgICAgICB2YWx1ZTogWydiJywgJ2wnLCAnYSddLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgdGV4dCBpZiBub3QgcHJlc2VudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IGNvbnZlcnRlci5wcm94eVNldFZhbHVlKCcnLCAnJywge1xuICAgICAgICB2YWx1ZTogWydiJywgJ2wnLCAnYSddLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZUJvZHkuc2hvdWxkLmVxbCh7XG4gICAgICAgIHRleHQ6ICdibGEnLFxuICAgICAgICB2YWx1ZTogWydiJywgJ2wnLCAnYSddLFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBrZWVwIHRoZSByZXNwb25zZSBib2R5IHVuY2hhbmdlZCBpZiBib3RoIHZhbHVlIGFuZCB0ZXh0IGFyZSBwcmVzZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgY29udmVydGVyLnByb3h5U2V0VmFsdWUoJycsICcnLCB7XG4gICAgICAgIHRleHQ6ICdibGEnLFxuICAgICAgICB2YWx1ZTogWydiJywgJ2wnLCAnYSddLFxuICAgICAgfSk7XG4gICAgICByZXNwb25zZUJvZHkuc2hvdWxkLmVxbCh7XG4gICAgICAgIHRleHQ6ICdibGEnLFxuICAgICAgICB2YWx1ZTogWydiJywgJ2wnLCAnYSddLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnZ2V0UHJvcGVydHknLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGpzb253cENvbnZlcnRlciwgdzNjQ29udmVydGVyO1xuICAgIGJlZm9yZShmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKGxldCBjb21tYW5kIG9mIENPTU1BTkRfVVJMU19DT05GTElDVFMpIHtcbiAgICAgICAgaWYgKGNvbW1hbmQuY29tbWFuZE5hbWVzLmluY2x1ZGVzKCdnZXRQcm9wZXJ0eScpKSB7XG4gICAgICAgICAganNvbndwQ29udmVydGVyID0gY29tbWFuZC5qc29ud3BDb252ZXJ0ZXI7XG4gICAgICAgICAgdzNjQ29udmVydGVyID0gY29tbWFuZC53M2NDb252ZXJ0ZXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNvbnZlcnQgXCJwcm9wZXJ0eS92YWx1ZVwiIHRvIFwiYXR0cmlidXRlL3ZhbHVlXCInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBqc29ud3BDb252ZXJ0ZXIoJy9zZXNzaW9uLzEyMy9lbGVtZW50LzQ1Ni9wcm9wZXJ0eS92YWx1ZScpLnNob3VsZC5lcXVhbCgnL3Nlc3Npb24vMTIzL2VsZW1lbnQvNDU2L2F0dHJpYnV0ZS92YWx1ZScpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY29udmVydCBcInByb3BlcnR5Lzpzb21lUHJvcE5hbWVcIiB0byBcImF0dHJpYnV0ZS86c29tZVByb3BOYW1lXCInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBqc29ud3BDb252ZXJ0ZXIoJy9zZXNzaW9uLzEyMy9lbGVtZW50LzQ1Ni9wcm9wZXJ0eS9zb21lUHJvcE5hbWUnKS5zaG91bGQuZXF1YWwoJy9zZXNzaW9uLzEyMy9lbGVtZW50LzQ1Ni9hdHRyaWJ1dGUvc29tZVByb3BOYW1lJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBub3QgY29udmVydCBmcm9tIEpTT05XUCB0byBXM0MnLCBmdW5jdGlvbiAoKSB7XG4gICAgICB3M2NDb252ZXJ0ZXIoJy9zZXNzaW9uLzEyMy9lbGVtZW50LzQ1Ni9hdHRyaWJ1dGUvc29tZUF0dHInKS5zaG91bGQuZXF1YWwoJy9zZXNzaW9uLzEyMy9lbGVtZW50LzQ1Ni9hdHRyaWJ1dGUvc29tZUF0dHInKTtcbiAgICAgIHczY0NvbnZlcnRlcignL3Nlc3Npb24vMTIzL2VsZW1lbnQvNDU2L3Byb3BlcnR5L3NvbWVQcm9wJykuc2hvdWxkLmVxdWFsKCcvc2Vzc2lvbi8xMjMvZWxlbWVudC80NTYvcHJvcGVydHkvc29tZVByb3AnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==