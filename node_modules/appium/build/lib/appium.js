"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AppiumDriver = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _config = require("./config");

var _drivers = require("./drivers");

var _baseDriver = require("@appium/base-driver");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils");

var _support = require("@appium/support");

const desiredCapabilityConstraints = {
  automationName: {
    presence: true,
    isString: true
  },
  platformName: {
    presence: true,
    isString: true
  }
};
const sessionsListGuard = new _asyncLock.default();
const pendingDriversGuard = new _asyncLock.default();

class AppiumDriver extends _baseDriver.BaseDriver {
  constructor(args) {
    if (args.tmpDir) {
      process.env.APPIUM_TMP_DIR = args.tmpDir;
    }

    super(args);
    this.desiredCapConstraints = desiredCapabilityConstraints;
    this.newCommandTimeoutMs = 0;
    this.args = Object.assign({}, args);
    this.sessions = {};
    this.pendingDrivers = {};
    this.pluginClasses = [];
    this.sessionPlugins = {};
    this.sessionlessPlugins = [];
    (0, _config.updateBuildInfo)();
  }

  get isCommandsQueueEnabled() {
    return false;
  }

  sessionExists(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && dstSession.sessionId !== null;
  }

  driverForSession(sessionId) {
    return this.sessions[sessionId];
  }

  async getStatus() {
    return {
      build: _lodash.default.clone((0, _config.getBuildInfo)())
    };
  }

  async getSessions() {
    const sessions = await sessionsListGuard.acquire(AppiumDriver.name, () => this.sessions);
    return _lodash.default.toPairs(sessions).map(([id, driver]) => ({
      id,
      capabilities: driver.caps
    }));
  }

  printNewSessionAnnouncement(driverName, driverVersion, driverBaseVersion) {
    _logger.default.info(driverVersion ? `Appium v${_config.APPIUM_VER} creating new ${driverName} (v${driverVersion}) session` : `Appium v${_config.APPIUM_VER} creating new ${driverName} session`);

    _logger.default.info(`Checking BaseDriver versions for Appium and ${driverName}`);

    _logger.default.info(AppiumDriver.baseVersion ? `Appium's BaseDriver version is ${AppiumDriver.baseVersion}` : `Could not determine Appium's BaseDriver version`);

    _logger.default.info(driverBaseVersion ? `${driverName}'s BaseDriver version is ${driverBaseVersion}` : `Could not determine ${driverName}'s BaseDriver version`);
  }

  _findMatchingDriver(...args) {
    return (0, _drivers.findMatchingDriver)(...args);
  }

  assignCliArgsToExtension(extType, extName, extClass, extInstance) {
    const cliArgs = (0, _utils.getExtensionArgs)(this.args[`${extType}Args`], extName);

    if (!_lodash.default.isEmpty(cliArgs)) {
      if (!_lodash.default.has(extClass, 'argsConstraints')) {
        throw new Error(`You sent in CLI args for the ${extName} ${extType}, but it ` + `does not define any`);
      }

      (0, _utils.validateExtensionArgs)(cliArgs, extClass.argsConstraints);
      extInstance.cliArgs = cliArgs;

      _logger.default.debug(`Set CLI arguments on ${extName} ${extType} instance: ${JSON.stringify(cliArgs)}`);
    }
  }

  async createSession(jsonwpCaps, reqCaps, w3cCapabilities) {
    const defaultCapabilities = _lodash.default.cloneDeep(this.args.defaultCapabilities);

    const defaultSettings = (0, _utils.pullSettings)(defaultCapabilities);
    jsonwpCaps = _lodash.default.cloneDeep(jsonwpCaps);
    const jwpSettings = Object.assign({}, defaultSettings, (0, _utils.pullSettings)(jsonwpCaps));
    w3cCapabilities = _lodash.default.cloneDeep(w3cCapabilities);
    const w3cSettings = Object.assign({}, jwpSettings);
    Object.assign(w3cSettings, (0, _utils.pullSettings)((w3cCapabilities || {}).alwaysMatch || {}));

    for (const firstMatchEntry of (w3cCapabilities || {}).firstMatch || []) {
      Object.assign(w3cSettings, (0, _utils.pullSettings)(firstMatchEntry));
    }

    let protocol;
    let innerSessionId, dCaps;

    try {
      const parsedCaps = (0, _utils.parseCapsForInnerDriver)(jsonwpCaps, w3cCapabilities, this.desiredCapConstraints, defaultCapabilities);
      const {
        desiredCaps,
        processedJsonwpCapabilities,
        processedW3CCapabilities,
        error
      } = parsedCaps;
      protocol = parsedCaps.protocol;

      if (error) {
        throw error;
      }

      const {
        driver: InnerDriver,
        version: driverVersion,
        driverName
      } = this._findMatchingDriver(this.driverConfig, desiredCaps);

      this.printNewSessionAnnouncement(InnerDriver.name, driverVersion, InnerDriver.baseVersion);

      if (this.args.sessionOverride) {
        await this.deleteAllSessions();
      }

      let runningDriversData, otherPendingDriversData;
      const driverInstance = new InnerDriver(this.args, true);

      if (this.args.relaxedSecurityEnabled) {
        _logger.default.info(`Applying relaxed security to '${InnerDriver.name}' as per ` + `server command line argument. All insecure features will be ` + `enabled unless explicitly disabled by --deny-insecure`);

        driverInstance.relaxedSecurityEnabled = true;
      }

      if (!_lodash.default.isEmpty(this.args.denyInsecure)) {
        _logger.default.info('Explicitly preventing use of insecure features:');

        this.args.denyInsecure.map(a => _logger.default.info(`    ${a}`));
        driverInstance.denyInsecure = this.args.denyInsecure;
      }

      if (!_lodash.default.isEmpty(this.args.allowInsecure)) {
        _logger.default.info('Explicitly enabling use of insecure features:');

        this.args.allowInsecure.map(a => _logger.default.info(`    ${a}`));
        driverInstance.allowInsecure = this.args.allowInsecure;
      }

      this.assignCliArgsToExtension('driver', driverName, InnerDriver, driverInstance);
      driverInstance.server = this.server;

      try {
        runningDriversData = await this.curSessionDataForDriver(InnerDriver);
      } catch (e) {
        throw new _baseDriver.errors.SessionNotCreatedError(e.message);
      }

      await pendingDriversGuard.acquire(AppiumDriver.name, () => {
        this.pendingDrivers[InnerDriver.name] = this.pendingDrivers[InnerDriver.name] || [];
        otherPendingDriversData = this.pendingDrivers[InnerDriver.name].map(drv => drv.driverData);
        this.pendingDrivers[InnerDriver.name].push(driverInstance);
      });

      try {
        [innerSessionId, dCaps] = await driverInstance.createSession(processedJsonwpCapabilities, reqCaps, processedW3CCapabilities, [...runningDriversData, ...otherPendingDriversData]);
        protocol = driverInstance.protocol;
        await sessionsListGuard.acquire(AppiumDriver.name, () => {
          this.sessions[innerSessionId] = driverInstance;
        });
      } finally {
        await pendingDriversGuard.acquire(AppiumDriver.name, () => {
          _lodash.default.pull(this.pendingDrivers[InnerDriver.name], driverInstance);
        });
      }

      this.attachUnexpectedShutdownHandler(driverInstance, innerSessionId);

      _logger.default.info(`New ${InnerDriver.name} session created successfully, session ` + `${innerSessionId} added to master session list`);

      driverInstance.startNewCommandTimeout();

      if (driverInstance.isW3CProtocol() && !_lodash.default.isEmpty(w3cSettings)) {
        _logger.default.info(`Applying the initial values to Appium settings parsed from W3C caps: ` + JSON.stringify(w3cSettings));

        await driverInstance.updateSettings(w3cSettings);
      } else if (driverInstance.isMjsonwpProtocol() && !_lodash.default.isEmpty(jwpSettings)) {
        _logger.default.info(`Applying the initial values to Appium settings parsed from MJSONWP caps: ` + JSON.stringify(jwpSettings));

        await driverInstance.updateSettings(jwpSettings);
      }
    } catch (error) {
      return {
        protocol,
        error
      };
    }

    return {
      protocol,
      value: [innerSessionId, dCaps, protocol]
    };
  }

  attachUnexpectedShutdownHandler(driver, innerSessionId) {
    const removeSessionFromMasterList = (cause = new Error('Unknown error')) => {
      _logger.default.warn(`Closing session, cause was '${cause.message}'`);

      _logger.default.info(`Removing session '${innerSessionId}' from our master session list`);

      delete this.sessions[innerSessionId];
      delete this.sessionPlugins[innerSessionId];
    };

    if (_lodash.default.isFunction((driver.onUnexpectedShutdown || {}).then)) {
      driver.onUnexpectedShutdown.then(() => {
        throw new Error('Unexpected shutdown');
      }).catch(e => {
        if (!(e instanceof _bluebird.default.CancellationError)) {
          removeSessionFromMasterList(e);
        }
      });
    } else if (_lodash.default.isFunction(driver.onUnexpectedShutdown)) {
      driver.onUnexpectedShutdown(removeSessionFromMasterList);
    } else {
      _logger.default.warn(`Failed to attach the unexpected shutdown listener. ` + `Is 'onUnexpectedShutdown' method available for '${driver.constructor.name}'?`);
    }
  }

  async curSessionDataForDriver(InnerDriver) {
    const sessions = await sessionsListGuard.acquire(AppiumDriver.name, () => this.sessions);

    const data = _lodash.default.values(sessions).filter(s => s.constructor.name === InnerDriver.name).map(s => s.driverData);

    for (let datum of data) {
      if (!datum) {
        throw new Error(`Problem getting session data for driver type ` + `${InnerDriver.name}; does it implement 'get ` + `driverData'?`);
      }
    }

    return data;
  }

  async deleteSession(sessionId) {
    let protocol;

    try {
      let otherSessionsData = null;
      let dstSession = null;
      await sessionsListGuard.acquire(AppiumDriver.name, () => {
        if (!this.sessions[sessionId]) {
          return;
        }

        const curConstructorName = this.sessions[sessionId].constructor.name;
        otherSessionsData = _lodash.default.toPairs(this.sessions).filter(([key, value]) => value.constructor.name === curConstructorName && key !== sessionId).map(([, value]) => value.driverData);
        dstSession = this.sessions[sessionId];
        protocol = dstSession.protocol;

        _logger.default.info(`Removing session ${sessionId} from our master session list`);

        delete this.sessions[sessionId];
        delete this.sessionPlugins[sessionId];
      });
      return {
        protocol,
        value: await dstSession.deleteSession(sessionId, otherSessionsData)
      };
    } catch (e) {
      _logger.default.error(`Had trouble ending session ${sessionId}: ${e.message}`);

      return {
        protocol,
        error: e
      };
    }
  }

  async deleteAllSessions(opts = {}) {
    const sessionsCount = _lodash.default.size(this.sessions);

    if (0 === sessionsCount) {
      _logger.default.debug('There are no active sessions for cleanup');

      return;
    }

    const {
      force = false,
      reason
    } = opts;

    _logger.default.debug(`Cleaning up ${_support.util.pluralize('active session', sessionsCount, true)}`);

    const cleanupPromises = force ? _lodash.default.values(this.sessions).map(drv => drv.startUnexpectedShutdown(reason && new Error(reason))) : _lodash.default.keys(this.sessions).map(id => this.deleteSession(id));

    for (const cleanupPromise of cleanupPromises) {
      try {
        await cleanupPromise;
      } catch (e) {
        _logger.default.debug(e);
      }
    }
  }

  pluginsForSession(sessionId = null) {
    let plugins = [];

    if (sessionId) {
      if (!this.sessionPlugins[sessionId]) {
        this.sessionPlugins[sessionId] = this.createPluginInstances();
      }

      plugins = this.sessionPlugins[sessionId];
    } else {
      if (_lodash.default.isEmpty(this.sessionlessPlugins)) {
        this.sessionlessPlugins = this.createPluginInstances();
      }

      plugins = this.sessionlessPlugins;
    }

    return plugins;
  }

  pluginsToHandleCmd(cmd, sessionId = null) {
    return this.pluginsForSession(sessionId).filter(p => _lodash.default.isFunction(p[cmd]) || _lodash.default.isFunction(p.handle));
  }

  createPluginInstances(sessionId) {
    if (!sessionId) {
      sessionId = 'sessionless';
    }

    sessionId = _lodash.default.truncate(sessionId, {
      length: 11
    });
    return this.pluginClasses.map(PluginClass => {
      const generalName = PluginClass.pluginName;
      const name = `${generalName} (${sessionId})`;
      const plugin = new PluginClass(name);
      this.assignCliArgsToExtension('plugin', generalName, PluginClass, plugin);
      return plugin;
    });
  }

  async executeCommand(cmd, ...args) {
    const isGetStatus = cmd === 'getStatus';
    const isUmbrellaCmd = !isGetStatus && isAppiumDriverCommand(cmd);
    const isSessionCmd = !isGetStatus && !isUmbrellaCmd;
    let sessionId = null;
    let dstSession = null;
    let protocol = null;
    let driver = this;

    if (isSessionCmd) {
      sessionId = _lodash.default.last(args);
      dstSession = await sessionsListGuard.acquire(AppiumDriver.name, () => this.sessions[sessionId]);

      if (!dstSession) {
        throw new Error(`The session with id '${sessionId}' does not exist`);
      }

      protocol = dstSession.protocol;
      driver = dstSession;
    }

    const plugins = this.pluginsToHandleCmd(cmd, sessionId);
    const cmdHandledBy = {
      default: false
    };

    const defaultBehavior = async () => {
      plugins.length && _logger.default.info(`Executing default handling behavior for command '${cmd}'`);
      cmdHandledBy.default = true;

      if (isGetStatus) {
        return await this.getStatus();
      }

      if (isUmbrellaCmd) {
        return await super.executeCommand(cmd, ...args);
      }

      return await dstSession.executeCommand(cmd, ...args);
    };

    const wrappedCmd = this.wrapCommandWithPlugins({
      driver,
      cmd,
      args,
      plugins,
      cmdHandledBy,
      next: defaultBehavior
    });
    const res = await this.executeWrappedCommand({
      wrappedCmd,
      protocol
    });
    plugins.length && this.logPluginHandlerReport({
      cmd,
      cmdHandledBy
    });
    return res;
  }

  wrapCommandWithPlugins({
    driver,
    cmd,
    args,
    next,
    cmdHandledBy,
    plugins
  }) {
    plugins.length && _logger.default.info(`Plugins which can handle cmd '${cmd}': ${plugins.map(p => p.name)}`);

    for (const plugin of plugins) {
      cmdHandledBy[plugin.name] = false;

      next = (_next => async () => {
        _logger.default.info(`Plugin ${plugin.name} is now handling cmd '${cmd}'`);

        cmdHandledBy[plugin.name] = true;

        if (plugin[cmd]) {
          return await plugin[cmd](_next, driver, ...args);
        }

        return await plugin.handle(_next, driver, cmd, ...args);
      })(next);
    }

    return next;
  }

  logPluginHandlerReport({
    cmd,
    cmdHandledBy
  }) {
    const didHandle = Object.keys(cmdHandledBy).filter(k => cmdHandledBy[k]);
    const didntHandle = Object.keys(cmdHandledBy).filter(k => !cmdHandledBy[k]);

    if (didntHandle.length > 0) {
      _logger.default.info(`Command '${cmd}' was not handled by the following beahviors or plugins, even ` + `though they were registered to handle it: ${JSON.stringify(didntHandle)}. The ` + `command *was* handled by these: ${JSON.stringify(didHandle)}.`);
    }
  }

  async executeWrappedCommand({
    wrappedCmd,
    protocol
  }) {
    let cmdRes,
        cmdErr,
        res = {};

    try {
      cmdRes = await wrappedCmd();
    } catch (e) {
      cmdErr = e;
    }

    if (_lodash.default.isPlainObject(cmdRes) && _lodash.default.has(cmdRes, 'protocol')) {
      res = cmdRes;
    } else {
      res.value = cmdRes;
      res.error = cmdErr;
      res.protocol = protocol;
    }

    return res;
  }

  proxyRouteIsAvoided(sessionId, method, url, body) {
    if (super.proxyRouteIsAvoided(sessionId, method, url, body)) {
      return true;
    }

    for (const plugin of this.pluginsForSession(sessionId)) {
      var _plugin$shouldAvoidPr;

      if ((_plugin$shouldAvoidPr = plugin.shouldAvoidProxy) !== null && _plugin$shouldAvoidPr !== void 0 && _plugin$shouldAvoidPr.call(plugin, method, url, body)) {
        _logger.default.info(`Request to ${url} would normally be proxied, but plugin ${plugin.name} wants ` + `to handle it internally. We'll avoid proxying in this case.`);

        return true;
      }
    }

    return false;
  }

  proxyActive(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && _lodash.default.isFunction(dstSession.proxyActive) && dstSession.proxyActive(sessionId);
  }

  getProxyAvoidList(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession ? dstSession.getProxyAvoidList() : [];
  }

  canProxy(sessionId) {
    const dstSession = this.sessions[sessionId];
    return dstSession && dstSession.canProxy(sessionId);
  }

}

exports.AppiumDriver = AppiumDriver;

function isAppiumDriverCommand(cmd) {
  return !(0, _baseDriver.isSessionCommand)(cmd) || cmd === 'deleteSession';
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hcHBpdW0uanMiXSwibmFtZXMiOlsiZGVzaXJlZENhcGFiaWxpdHlDb25zdHJhaW50cyIsImF1dG9tYXRpb25OYW1lIiwicHJlc2VuY2UiLCJpc1N0cmluZyIsInBsYXRmb3JtTmFtZSIsInNlc3Npb25zTGlzdEd1YXJkIiwiQXN5bmNMb2NrIiwicGVuZGluZ0RyaXZlcnNHdWFyZCIsIkFwcGl1bURyaXZlciIsIkJhc2VEcml2ZXIiLCJjb25zdHJ1Y3RvciIsImFyZ3MiLCJ0bXBEaXIiLCJwcm9jZXNzIiwiZW52IiwiQVBQSVVNX1RNUF9ESVIiLCJkZXNpcmVkQ2FwQ29uc3RyYWludHMiLCJuZXdDb21tYW5kVGltZW91dE1zIiwiT2JqZWN0IiwiYXNzaWduIiwic2Vzc2lvbnMiLCJwZW5kaW5nRHJpdmVycyIsInBsdWdpbkNsYXNzZXMiLCJzZXNzaW9uUGx1Z2lucyIsInNlc3Npb25sZXNzUGx1Z2lucyIsImlzQ29tbWFuZHNRdWV1ZUVuYWJsZWQiLCJzZXNzaW9uRXhpc3RzIiwic2Vzc2lvbklkIiwiZHN0U2Vzc2lvbiIsImRyaXZlckZvclNlc3Npb24iLCJnZXRTdGF0dXMiLCJidWlsZCIsIl8iLCJjbG9uZSIsImdldFNlc3Npb25zIiwiYWNxdWlyZSIsIm5hbWUiLCJ0b1BhaXJzIiwibWFwIiwiaWQiLCJkcml2ZXIiLCJjYXBhYmlsaXRpZXMiLCJjYXBzIiwicHJpbnROZXdTZXNzaW9uQW5ub3VuY2VtZW50IiwiZHJpdmVyTmFtZSIsImRyaXZlclZlcnNpb24iLCJkcml2ZXJCYXNlVmVyc2lvbiIsImxvZyIsImluZm8iLCJBUFBJVU1fVkVSIiwiYmFzZVZlcnNpb24iLCJfZmluZE1hdGNoaW5nRHJpdmVyIiwiYXNzaWduQ2xpQXJnc1RvRXh0ZW5zaW9uIiwiZXh0VHlwZSIsImV4dE5hbWUiLCJleHRDbGFzcyIsImV4dEluc3RhbmNlIiwiY2xpQXJncyIsImlzRW1wdHkiLCJoYXMiLCJFcnJvciIsImFyZ3NDb25zdHJhaW50cyIsImRlYnVnIiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZVNlc3Npb24iLCJqc29ud3BDYXBzIiwicmVxQ2FwcyIsInczY0NhcGFiaWxpdGllcyIsImRlZmF1bHRDYXBhYmlsaXRpZXMiLCJjbG9uZURlZXAiLCJkZWZhdWx0U2V0dGluZ3MiLCJqd3BTZXR0aW5ncyIsInczY1NldHRpbmdzIiwiYWx3YXlzTWF0Y2giLCJmaXJzdE1hdGNoRW50cnkiLCJmaXJzdE1hdGNoIiwicHJvdG9jb2wiLCJpbm5lclNlc3Npb25JZCIsImRDYXBzIiwicGFyc2VkQ2FwcyIsImRlc2lyZWRDYXBzIiwicHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzIiwicHJvY2Vzc2VkVzNDQ2FwYWJpbGl0aWVzIiwiZXJyb3IiLCJJbm5lckRyaXZlciIsInZlcnNpb24iLCJkcml2ZXJDb25maWciLCJzZXNzaW9uT3ZlcnJpZGUiLCJkZWxldGVBbGxTZXNzaW9ucyIsInJ1bm5pbmdEcml2ZXJzRGF0YSIsIm90aGVyUGVuZGluZ0RyaXZlcnNEYXRhIiwiZHJpdmVySW5zdGFuY2UiLCJyZWxheGVkU2VjdXJpdHlFbmFibGVkIiwiZGVueUluc2VjdXJlIiwiYSIsImFsbG93SW5zZWN1cmUiLCJzZXJ2ZXIiLCJjdXJTZXNzaW9uRGF0YUZvckRyaXZlciIsImUiLCJlcnJvcnMiLCJTZXNzaW9uTm90Q3JlYXRlZEVycm9yIiwibWVzc2FnZSIsImRydiIsImRyaXZlckRhdGEiLCJwdXNoIiwicHVsbCIsImF0dGFjaFVuZXhwZWN0ZWRTaHV0ZG93bkhhbmRsZXIiLCJzdGFydE5ld0NvbW1hbmRUaW1lb3V0IiwiaXNXM0NQcm90b2NvbCIsInVwZGF0ZVNldHRpbmdzIiwiaXNNanNvbndwUHJvdG9jb2wiLCJ2YWx1ZSIsInJlbW92ZVNlc3Npb25Gcm9tTWFzdGVyTGlzdCIsImNhdXNlIiwid2FybiIsImlzRnVuY3Rpb24iLCJvblVuZXhwZWN0ZWRTaHV0ZG93biIsInRoZW4iLCJjYXRjaCIsIkIiLCJDYW5jZWxsYXRpb25FcnJvciIsImRhdGEiLCJ2YWx1ZXMiLCJmaWx0ZXIiLCJzIiwiZGF0dW0iLCJkZWxldGVTZXNzaW9uIiwib3RoZXJTZXNzaW9uc0RhdGEiLCJjdXJDb25zdHJ1Y3Rvck5hbWUiLCJrZXkiLCJvcHRzIiwic2Vzc2lvbnNDb3VudCIsInNpemUiLCJmb3JjZSIsInJlYXNvbiIsInV0aWwiLCJwbHVyYWxpemUiLCJjbGVhbnVwUHJvbWlzZXMiLCJzdGFydFVuZXhwZWN0ZWRTaHV0ZG93biIsImtleXMiLCJjbGVhbnVwUHJvbWlzZSIsInBsdWdpbnNGb3JTZXNzaW9uIiwicGx1Z2lucyIsImNyZWF0ZVBsdWdpbkluc3RhbmNlcyIsInBsdWdpbnNUb0hhbmRsZUNtZCIsImNtZCIsInAiLCJoYW5kbGUiLCJ0cnVuY2F0ZSIsImxlbmd0aCIsIlBsdWdpbkNsYXNzIiwiZ2VuZXJhbE5hbWUiLCJwbHVnaW5OYW1lIiwicGx1Z2luIiwiZXhlY3V0ZUNvbW1hbmQiLCJpc0dldFN0YXR1cyIsImlzVW1icmVsbGFDbWQiLCJpc0FwcGl1bURyaXZlckNvbW1hbmQiLCJpc1Nlc3Npb25DbWQiLCJsYXN0IiwiY21kSGFuZGxlZEJ5IiwiZGVmYXVsdCIsImRlZmF1bHRCZWhhdmlvciIsIndyYXBwZWRDbWQiLCJ3cmFwQ29tbWFuZFdpdGhQbHVnaW5zIiwibmV4dCIsInJlcyIsImV4ZWN1dGVXcmFwcGVkQ29tbWFuZCIsImxvZ1BsdWdpbkhhbmRsZXJSZXBvcnQiLCJfbmV4dCIsImRpZEhhbmRsZSIsImsiLCJkaWRudEhhbmRsZSIsImNtZFJlcyIsImNtZEVyciIsImlzUGxhaW5PYmplY3QiLCJwcm94eVJvdXRlSXNBdm9pZGVkIiwibWV0aG9kIiwidXJsIiwiYm9keSIsInNob3VsZEF2b2lkUHJveHkiLCJwcm94eUFjdGl2ZSIsImdldFByb3h5QXZvaWRMaXN0IiwiY2FuUHJveHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsNEJBQTRCLEdBQUc7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TyxTQUFkLENBQW5CO0FBQ0EsV0FBT0MsVUFBVSxJQUFJQSxVQUFVLENBQUM0SixRQUFYLENBQW9CN0osU0FBcEIsQ0FBckI7QUFDRDs7QUFubEJtQzs7OztBQXdsQnRDLFNBQVNtSSxxQkFBVCxDQUFnQ1osR0FBaEMsRUFBcUM7QUFDbkMsU0FBTyxDQUFDLGtDQUFpQkEsR0FBakIsQ0FBRCxJQUEwQkEsR0FBRyxLQUFLLGVBQXpDO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRCdWlsZEluZm8sIHVwZGF0ZUJ1aWxkSW5mbywgQVBQSVVNX1ZFUiB9IGZyb20gJy4vY29uZmlnJztcbmltcG9ydCB7IGZpbmRNYXRjaGluZ0RyaXZlciB9IGZyb20gJy4vZHJpdmVycyc7XG5pbXBvcnQgeyBCYXNlRHJpdmVyLCBlcnJvcnMsIGlzU2Vzc2lvbkNvbW1hbmQgfSBmcm9tICdAYXBwaXVtL2Jhc2UtZHJpdmVyJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQgeyBnZXRFeHRlbnNpb25BcmdzLCBwYXJzZUNhcHNGb3JJbm5lckRyaXZlciwgcHVsbFNldHRpbmdzLCB2YWxpZGF0ZUV4dGVuc2lvbkFyZ3MgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuXG5jb25zdCBkZXNpcmVkQ2FwYWJpbGl0eUNvbnN0cmFpbnRzID0ge1xuICBhdXRvbWF0aW9uTmFtZToge1xuICAgIHByZXNlbmNlOiB0cnVlLFxuICAgIGlzU3RyaW5nOiB0cnVlLFxuICB9LFxuICBwbGF0Zm9ybU5hbWU6IHtcbiAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgfSxcbn07XG5cbmNvbnN0IHNlc3Npb25zTGlzdEd1YXJkID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgcGVuZGluZ0RyaXZlcnNHdWFyZCA9IG5ldyBBc3luY0xvY2soKTtcblxuY2xhc3MgQXBwaXVtRHJpdmVyIGV4dGVuZHMgQmFzZURyaXZlciB7XG4gIGNvbnN0cnVjdG9yIChhcmdzKSB7XG4gICAgLy8gSXQgaXMgbmVjZXNzYXJ5IHRvIHNldCBgLS10bXBgIGhlcmUgc2luY2UgaXQgc2hvdWxkIGJlIHNldCB0b1xuICAgIC8vIHByb2Nlc3MuZW52LkFQUElVTV9UTVBfRElSIG9uY2UgYXQgYW4gaW5pdGlhbCBwb2ludCBpbiB0aGUgQXBwaXVtIGxpZmVjeWNsZS5cbiAgICAvLyBUaGUgcHJvY2VzcyBhcmd1bWVudCB3aWxsIGJlIHJlZmVyZW5jZWQgYnkgQmFzZURyaXZlci5cbiAgICAvLyBQbGVhc2UgY2FsbCBAYXBwaXVtL3N1cHBvcnQudGVtcERpciBtb2R1bGUgdG8gYXBwbHkgdGhpcyBiZW5lZml0LlxuICAgIGlmIChhcmdzLnRtcERpcikge1xuICAgICAgcHJvY2Vzcy5lbnYuQVBQSVVNX1RNUF9ESVIgPSBhcmdzLnRtcERpcjtcbiAgICB9XG5cbiAgICBzdXBlcihhcmdzKTtcblxuICAgIHRoaXMuZGVzaXJlZENhcENvbnN0cmFpbnRzID0gZGVzaXJlZENhcGFiaWxpdHlDb25zdHJhaW50cztcblxuICAgIC8vIHRoZSBtYWluIEFwcGl1bSBEcml2ZXIgaGFzIG5vIG5ldyBjb21tYW5kIHRpbWVvdXRcbiAgICB0aGlzLm5ld0NvbW1hbmRUaW1lb3V0TXMgPSAwO1xuXG4gICAgdGhpcy5hcmdzID0gT2JqZWN0LmFzc2lnbih7fSwgYXJncyk7XG5cbiAgICAvLyBBY2Nlc3MgdG8gc2Vzc2lvbnMgbGlzdCBtdXN0IGJlIGd1YXJkZWQgd2l0aCBhIFNlbWFwaG9yZSwgYmVjYXVzZVxuICAgIC8vIGl0IG1pZ2h0IGJlIGNoYW5nZWQgYnkgb3RoZXIgYXN5bmMgY2FsbHMgYXQgYW55IHRpbWVcbiAgICAvLyBJdCBpcyBub3QgcmVjb21tZW5kZWQgdG8gYWNjZXNzIHRoaXMgcHJvcGVydHkgZGlyZWN0bHkgZnJvbSB0aGUgb3V0c2lkZVxuICAgIHRoaXMuc2Vzc2lvbnMgPSB7fTtcblxuICAgIC8vIEFjY2VzcyB0byBwZW5kaW5nIGRyaXZlcnMgbGlzdCBtdXN0IGJlIGd1YXJkZWQgd2l0aCBhIFNlbWFwaG9yZSwgYmVjYXVzZVxuICAgIC8vIGl0IG1pZ2h0IGJlIGNoYW5nZWQgYnkgb3RoZXIgYXN5bmMgY2FsbHMgYXQgYW55IHRpbWVcbiAgICAvLyBJdCBpcyBub3QgcmVjb21tZW5kZWQgdG8gYWNjZXNzIHRoaXMgcHJvcGVydHkgZGlyZWN0bHkgZnJvbSB0aGUgb3V0c2lkZVxuICAgIHRoaXMucGVuZGluZ0RyaXZlcnMgPSB7fTtcblxuICAgIHRoaXMucGx1Z2luQ2xhc3NlcyA9IFtdOyAvLyBsaXN0IG9mIHdoaWNoIHBsdWdpbnMgYXJlIGFjdGl2ZVxuICAgIHRoaXMuc2Vzc2lvblBsdWdpbnMgPSB7fTsgLy8gbWFwIG9mIHNlc3Npb25zIHRvIGFjdHVhbCBwbHVnaW4gaW5zdGFuY2VzIHBlciBzZXNzaW9uXG4gICAgdGhpcy5zZXNzaW9ubGVzc1BsdWdpbnMgPSBbXTsgLy8gc29tZSBjb21tYW5kcyBhcmUgc2Vzc2lvbmxlc3MsIHNvIHdlIG5lZWQgYSBzZXQgb2YgcGx1Z2lucyBmb3IgdGhlbVxuXG4gICAgLy8gYWxsb3cgdGhpcyB0byBoYXBwZW4gaW4gdGhlIGJhY2tncm91bmQsIHNvIG5vIGBhd2FpdGBcbiAgICB1cGRhdGVCdWlsZEluZm8oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgY29tbWFuZHMgcXVldWVpbmcgZm9yIHRoZSB1bWJyZWxsYSBBcHBpdW0gZHJpdmVyXG4gICAqL1xuICBnZXQgaXNDb21tYW5kc1F1ZXVlRW5hYmxlZCAoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgc2Vzc2lvbkV4aXN0cyAoc2Vzc2lvbklkKSB7XG4gICAgY29uc3QgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICByZXR1cm4gZHN0U2Vzc2lvbiAmJiBkc3RTZXNzaW9uLnNlc3Npb25JZCAhPT0gbnVsbDtcbiAgfVxuXG4gIGRyaXZlckZvclNlc3Npb24gKHNlc3Npb25JZCkge1xuICAgIHJldHVybiB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gIH1cblxuICBhc3luYyBnZXRTdGF0dXMgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICByZXR1cm4ge1xuICAgICAgYnVpbGQ6IF8uY2xvbmUoZ2V0QnVpbGRJbmZvKCkpLFxuICAgIH07XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9ucyAoKSB7XG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBzZXNzaW9uc0xpc3RHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB0aGlzLnNlc3Npb25zKTtcbiAgICByZXR1cm4gXy50b1BhaXJzKHNlc3Npb25zKVxuICAgICAgLm1hcCgoW2lkLCBkcml2ZXJdKSA9PiAoe2lkLCBjYXBhYmlsaXRpZXM6IGRyaXZlci5jYXBzfSkpO1xuICB9XG5cbiAgcHJpbnROZXdTZXNzaW9uQW5ub3VuY2VtZW50IChkcml2ZXJOYW1lLCBkcml2ZXJWZXJzaW9uLCBkcml2ZXJCYXNlVmVyc2lvbikge1xuICAgIGxvZy5pbmZvKGRyaXZlclZlcnNpb25cbiAgICAgID8gYEFwcGl1bSB2JHtBUFBJVU1fVkVSfSBjcmVhdGluZyBuZXcgJHtkcml2ZXJOYW1lfSAodiR7ZHJpdmVyVmVyc2lvbn0pIHNlc3Npb25gXG4gICAgICA6IGBBcHBpdW0gdiR7QVBQSVVNX1ZFUn0gY3JlYXRpbmcgbmV3ICR7ZHJpdmVyTmFtZX0gc2Vzc2lvbmBcbiAgICApO1xuICAgIGxvZy5pbmZvKGBDaGVja2luZyBCYXNlRHJpdmVyIHZlcnNpb25zIGZvciBBcHBpdW0gYW5kICR7ZHJpdmVyTmFtZX1gKTtcbiAgICBsb2cuaW5mbyhBcHBpdW1Ecml2ZXIuYmFzZVZlcnNpb25cbiAgICAgID8gYEFwcGl1bSdzIEJhc2VEcml2ZXIgdmVyc2lvbiBpcyAke0FwcGl1bURyaXZlci5iYXNlVmVyc2lvbn1gXG4gICAgICA6IGBDb3VsZCBub3QgZGV0ZXJtaW5lIEFwcGl1bSdzIEJhc2VEcml2ZXIgdmVyc2lvbmBcbiAgICApO1xuICAgIGxvZy5pbmZvKGRyaXZlckJhc2VWZXJzaW9uXG4gICAgICA/IGAke2RyaXZlck5hbWV9J3MgQmFzZURyaXZlciB2ZXJzaW9uIGlzICR7ZHJpdmVyQmFzZVZlcnNpb259YFxuICAgICAgOiBgQ291bGQgbm90IGRldGVybWluZSAke2RyaXZlck5hbWV9J3MgQmFzZURyaXZlciB2ZXJzaW9uYFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBpcyBqdXN0IGFuIGFsaWFzIGZvciBkcml2ZXIuanMncyBtZXRob2QsIHdoaWNoIGlzIG5lY2Vzc2FyeSBmb3JcbiAgICogbW9ja2luZyBpbiB0aGUgdGVzdCBzdWl0ZVxuICAgKi9cbiAgX2ZpbmRNYXRjaGluZ0RyaXZlciAoLi4uYXJncykge1xuICAgIHJldHVybiBmaW5kTWF0Y2hpbmdEcml2ZXIoLi4uYXJncyk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYW5kIGFzc2lnbiBDTEkgYXJncyBmb3IgYSBkcml2ZXIgb3IgcGx1Z2luXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBleHRUeXBlICdkcml2ZXInIG9yICdwbHVnaW4nXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBleHROYW1lIHRoZSBuYW1lIG9mIHRoZSBleHRlbnNpb25cbiAgICogQHBhcmFtIHtPYmplY3RDb25zdHJ1Y3Rvcn0gZXh0Q2xhc3MgdGhlIGNsYXNzIG9mIHRoZSBleHRlbnNpb25cbiAgICogQHBhcmFtIHtPYmplY3R9IGV4dEluc3RhbmNlIHRoZSBkcml2ZXIgb3IgcGx1Z2luIGluc3RhbmNlXG4gICAqL1xuICBhc3NpZ25DbGlBcmdzVG9FeHRlbnNpb24gKGV4dFR5cGUsIGV4dE5hbWUsIGV4dENsYXNzLCBleHRJbnN0YW5jZSkge1xuICAgIGNvbnN0IGNsaUFyZ3MgPSBnZXRFeHRlbnNpb25BcmdzKHRoaXMuYXJnc1tgJHtleHRUeXBlfUFyZ3NgXSwgZXh0TmFtZSk7XG4gICAgaWYgKCFfLmlzRW1wdHkoY2xpQXJncykpIHtcbiAgICAgIGlmICghXy5oYXMoZXh0Q2xhc3MsICdhcmdzQ29uc3RyYWludHMnKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFlvdSBzZW50IGluIENMSSBhcmdzIGZvciB0aGUgJHtleHROYW1lfSAke2V4dFR5cGV9LCBidXQgaXQgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgZG9lcyBub3QgZGVmaW5lIGFueWApO1xuICAgICAgfVxuICAgICAgdmFsaWRhdGVFeHRlbnNpb25BcmdzKGNsaUFyZ3MsIGV4dENsYXNzLmFyZ3NDb25zdHJhaW50cyk7XG4gICAgICBleHRJbnN0YW5jZS5jbGlBcmdzID0gY2xpQXJncztcbiAgICAgIGxvZy5kZWJ1ZyhgU2V0IENMSSBhcmd1bWVudHMgb24gJHtleHROYW1lfSAke2V4dFR5cGV9IGluc3RhbmNlOiAke0pTT04uc3RyaW5naWZ5KGNsaUFyZ3MpfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgc2Vzc2lvblxuICAgKiBAcGFyYW0ge09iamVjdH0ganNvbndwQ2FwcyBKU09OV1AgZm9ybWF0dGVkIGRlc2lyZWQgY2FwYWJpbGl0aWVzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSByZXFDYXBzIFJlcXVpcmVkIGNhcGFiaWxpdGllcyAoSlNPTldQIHN0YW5kYXJkKVxuICAgKiBAcGFyYW0ge09iamVjdH0gdzNjQ2FwYWJpbGl0aWVzIFczQyBjYXBhYmlsaXRpZXNcbiAgICogQHJldHVybiB7QXJyYXl9IFVuaXF1ZSBzZXNzaW9uIElEIGFuZCBjYXBhYmlsaXRpZXNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVNlc3Npb24gKGpzb253cENhcHMsIHJlcUNhcHMsIHczY0NhcGFiaWxpdGllcykge1xuICAgIGNvbnN0IGRlZmF1bHRDYXBhYmlsaXRpZXMgPSBfLmNsb25lRGVlcCh0aGlzLmFyZ3MuZGVmYXVsdENhcGFiaWxpdGllcyk7XG4gICAgY29uc3QgZGVmYXVsdFNldHRpbmdzID0gcHVsbFNldHRpbmdzKGRlZmF1bHRDYXBhYmlsaXRpZXMpO1xuICAgIGpzb253cENhcHMgPSBfLmNsb25lRGVlcChqc29ud3BDYXBzKTtcbiAgICBjb25zdCBqd3BTZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRTZXR0aW5ncywgcHVsbFNldHRpbmdzKGpzb253cENhcHMpKTtcbiAgICB3M2NDYXBhYmlsaXRpZXMgPSBfLmNsb25lRGVlcCh3M2NDYXBhYmlsaXRpZXMpO1xuICAgIC8vIEl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlIGNsaWVudCBvbmx5IHByb3ZpZGVzIGNhcHMgdXNpbmcgSlNPTldQIHN0YW5kYXJkLFxuICAgIC8vIGFsdGhvdWdoIGZpcnN0TWF0Y2gvYWx3YXlzTWF0Y2ggcHJvcGVydGllcyBhcmUgc3RpbGwgcHJlc2VudC5cbiAgICAvLyBJbiBzdWNoIGNhc2Ugd2UgYXNzdW1lIHRoZSBjbGllbnQgdW5kZXJzdGFuZHMgVzNDIHByb3RvY29sIGFuZCBtZXJnZSB0aGUgZ2l2ZW5cbiAgICAvLyBKU09OV1AgY2FwcyB0byBXM0MgY2Fwc1xuICAgIGNvbnN0IHczY1NldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgandwU2V0dGluZ3MpO1xuICAgIE9iamVjdC5hc3NpZ24odzNjU2V0dGluZ3MsIHB1bGxTZXR0aW5ncygodzNjQ2FwYWJpbGl0aWVzIHx8IHt9KS5hbHdheXNNYXRjaCB8fCB7fSkpO1xuICAgIGZvciAoY29uc3QgZmlyc3RNYXRjaEVudHJ5IG9mICgodzNjQ2FwYWJpbGl0aWVzIHx8IHt9KS5maXJzdE1hdGNoIHx8IFtdKSkge1xuICAgICAgT2JqZWN0LmFzc2lnbih3M2NTZXR0aW5ncywgcHVsbFNldHRpbmdzKGZpcnN0TWF0Y2hFbnRyeSkpO1xuICAgIH1cblxuICAgIGxldCBwcm90b2NvbDtcbiAgICBsZXQgaW5uZXJTZXNzaW9uSWQsIGRDYXBzO1xuICAgIHRyeSB7XG4gICAgICAvLyBQYXJzZSB0aGUgY2FwcyBpbnRvIGEgZm9ybWF0IHRoYXQgdGhlIElubmVyRHJpdmVyIHdpbGwgYWNjZXB0XG4gICAgICBjb25zdCBwYXJzZWRDYXBzID0gcGFyc2VDYXBzRm9ySW5uZXJEcml2ZXIoXG4gICAgICAgIGpzb253cENhcHMsXG4gICAgICAgIHczY0NhcGFiaWxpdGllcyxcbiAgICAgICAgdGhpcy5kZXNpcmVkQ2FwQ29uc3RyYWludHMsXG4gICAgICAgIGRlZmF1bHRDYXBhYmlsaXRpZXNcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHtkZXNpcmVkQ2FwcywgcHJvY2Vzc2VkSnNvbndwQ2FwYWJpbGl0aWVzLCBwcm9jZXNzZWRXM0NDYXBhYmlsaXRpZXMsIGVycm9yfSA9IHBhcnNlZENhcHM7XG4gICAgICBwcm90b2NvbCA9IHBhcnNlZENhcHMucHJvdG9jb2w7XG5cbiAgICAgIC8vIElmIHRoZSBwYXJzaW5nIG9mIHRoZSBjYXBzIHByb2R1Y2VkIGFuIGVycm9yLCB0aHJvdyBpdCBpbiBoZXJlXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZHJpdmVyOiBJbm5lckRyaXZlcixcbiAgICAgICAgdmVyc2lvbjogZHJpdmVyVmVyc2lvbixcbiAgICAgICAgZHJpdmVyTmFtZVxuICAgICAgfSA9IHRoaXMuX2ZpbmRNYXRjaGluZ0RyaXZlcih0aGlzLmRyaXZlckNvbmZpZywgZGVzaXJlZENhcHMpO1xuICAgICAgdGhpcy5wcmludE5ld1Nlc3Npb25Bbm5vdW5jZW1lbnQoSW5uZXJEcml2ZXIubmFtZSwgZHJpdmVyVmVyc2lvbiwgSW5uZXJEcml2ZXIuYmFzZVZlcnNpb24pO1xuXG4gICAgICBpZiAodGhpcy5hcmdzLnNlc3Npb25PdmVycmlkZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmRlbGV0ZUFsbFNlc3Npb25zKCk7XG4gICAgICB9XG5cbiAgICAgIGxldCBydW5uaW5nRHJpdmVyc0RhdGEsIG90aGVyUGVuZGluZ0RyaXZlcnNEYXRhO1xuXG4gICAgICBjb25zdCBkcml2ZXJJbnN0YW5jZSA9IG5ldyBJbm5lckRyaXZlcih0aGlzLmFyZ3MsIHRydWUpO1xuXG4gICAgICAvLyBXZSB3YW50IHRvIGFzc2lnbiBzZWN1cml0eSB2YWx1ZXMgZGlyZWN0bHkgb24gdGhlIGRyaXZlci4gVGhlIGRyaXZlclxuICAgICAgLy8gc2hvdWxkIG5vdCByZWFkIHNlY3VyaXR5IHZhbHVlcyBmcm9tIGB0aGlzLm9wdHNgIGJlY2F1c2UgdGhvc2UgdmFsdWVzXG4gICAgICAvLyBjb3VsZCBoYXZlIGJlZW4gc2V0IGJ5IGEgbWFsaWNpb3VzIHVzZXIgdmlhIGNhcGFiaWxpdGllcywgd2hlcmVhcyB3ZVxuICAgICAgLy8gd2FudCBhIGd1YXJhbnRlZSB0aGUgdmFsdWVzIHdlcmUgc2V0IGJ5IHRoZSBhcHBpdW0gc2VydmVyIGFkbWluXG4gICAgICBpZiAodGhpcy5hcmdzLnJlbGF4ZWRTZWN1cml0eUVuYWJsZWQpIHtcbiAgICAgICAgbG9nLmluZm8oYEFwcGx5aW5nIHJlbGF4ZWQgc2VjdXJpdHkgdG8gJyR7SW5uZXJEcml2ZXIubmFtZX0nIGFzIHBlciBgICtcbiAgICAgICAgICAgICAgICAgYHNlcnZlciBjb21tYW5kIGxpbmUgYXJndW1lbnQuIEFsbCBpbnNlY3VyZSBmZWF0dXJlcyB3aWxsIGJlIGAgK1xuICAgICAgICAgICAgICAgICBgZW5hYmxlZCB1bmxlc3MgZXhwbGljaXRseSBkaXNhYmxlZCBieSAtLWRlbnktaW5zZWN1cmVgKTtcbiAgICAgICAgZHJpdmVySW5zdGFuY2UucmVsYXhlZFNlY3VyaXR5RW5hYmxlZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmICghXy5pc0VtcHR5KHRoaXMuYXJncy5kZW55SW5zZWN1cmUpKSB7XG4gICAgICAgIGxvZy5pbmZvKCdFeHBsaWNpdGx5IHByZXZlbnRpbmcgdXNlIG9mIGluc2VjdXJlIGZlYXR1cmVzOicpO1xuICAgICAgICB0aGlzLmFyZ3MuZGVueUluc2VjdXJlLm1hcCgoYSkgPT4gbG9nLmluZm8oYCAgICAke2F9YCkpO1xuICAgICAgICBkcml2ZXJJbnN0YW5jZS5kZW55SW5zZWN1cmUgPSB0aGlzLmFyZ3MuZGVueUluc2VjdXJlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLmFyZ3MuYWxsb3dJbnNlY3VyZSkpIHtcbiAgICAgICAgbG9nLmluZm8oJ0V4cGxpY2l0bHkgZW5hYmxpbmcgdXNlIG9mIGluc2VjdXJlIGZlYXR1cmVzOicpO1xuICAgICAgICB0aGlzLmFyZ3MuYWxsb3dJbnNlY3VyZS5tYXAoKGEpID0+IGxvZy5pbmZvKGAgICAgJHthfWApKTtcbiAgICAgICAgZHJpdmVySW5zdGFuY2UuYWxsb3dJbnNlY3VyZSA9IHRoaXMuYXJncy5hbGxvd0luc2VjdXJlO1xuICAgICAgfVxuXG4gICAgICAvLyBMaWtld2lzZSwgYW55IGRyaXZlci1zcGVjaWZpYyBDTEkgYXJncyB0aGF0IHdlcmUgcGFzc2VkIGluIHNob3VsZCBiZSBhc3NpZ25lZCBkaXJlY3RseSB0b1xuICAgICAgLy8gdGhlIGRyaXZlciBzbyB0aGF0IHRoZXkgY2Fubm90IGJlIG1pbWlja2VkIGJ5IGEgbWFsaWNpb3VzIHVzZXIgc2VuZGluZyBpbiBjYXBhYmlsaXRpZXNcbiAgICAgIHRoaXMuYXNzaWduQ2xpQXJnc1RvRXh0ZW5zaW9uKCdkcml2ZXInLCBkcml2ZXJOYW1lLCBJbm5lckRyaXZlciwgZHJpdmVySW5zdGFuY2UpO1xuXG5cbiAgICAgIC8vIFRoaXMgYXNzaWdubWVudCBpcyByZXF1aXJlZCBmb3IgY29ycmVjdCB3ZWIgc29ja2V0cyBmdW5jdGlvbmFsaXR5IGluc2lkZSB0aGUgZHJpdmVyXG4gICAgICBkcml2ZXJJbnN0YW5jZS5zZXJ2ZXIgPSB0aGlzLnNlcnZlcjtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJ1bm5pbmdEcml2ZXJzRGF0YSA9IGF3YWl0IHRoaXMuY3VyU2Vzc2lvbkRhdGFGb3JEcml2ZXIoSW5uZXJEcml2ZXIpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IoZS5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHBlbmRpbmdEcml2ZXJzR3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4ge1xuICAgICAgICB0aGlzLnBlbmRpbmdEcml2ZXJzW0lubmVyRHJpdmVyLm5hbWVdID0gdGhpcy5wZW5kaW5nRHJpdmVyc1tJbm5lckRyaXZlci5uYW1lXSB8fCBbXTtcbiAgICAgICAgb3RoZXJQZW5kaW5nRHJpdmVyc0RhdGEgPSB0aGlzLnBlbmRpbmdEcml2ZXJzW0lubmVyRHJpdmVyLm5hbWVdLm1hcCgoZHJ2KSA9PiBkcnYuZHJpdmVyRGF0YSk7XG4gICAgICAgIHRoaXMucGVuZGluZ0RyaXZlcnNbSW5uZXJEcml2ZXIubmFtZV0ucHVzaChkcml2ZXJJbnN0YW5jZSk7XG4gICAgICB9KTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgW2lubmVyU2Vzc2lvbklkLCBkQ2Fwc10gPSBhd2FpdCBkcml2ZXJJbnN0YW5jZS5jcmVhdGVTZXNzaW9uKFxuICAgICAgICAgIHByb2Nlc3NlZEpzb253cENhcGFiaWxpdGllcyxcbiAgICAgICAgICByZXFDYXBzLFxuICAgICAgICAgIHByb2Nlc3NlZFczQ0NhcGFiaWxpdGllcyxcbiAgICAgICAgICBbLi4ucnVubmluZ0RyaXZlcnNEYXRhLCAuLi5vdGhlclBlbmRpbmdEcml2ZXJzRGF0YV1cbiAgICAgICAgKTtcbiAgICAgICAgcHJvdG9jb2wgPSBkcml2ZXJJbnN0YW5jZS5wcm90b2NvbDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbnNMaXN0R3VhcmQuYWNxdWlyZShBcHBpdW1Ecml2ZXIubmFtZSwgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc2Vzc2lvbnNbaW5uZXJTZXNzaW9uSWRdID0gZHJpdmVySW5zdGFuY2U7XG4gICAgICAgIH0pO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgcGVuZGluZ0RyaXZlcnNHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB7XG4gICAgICAgICAgXy5wdWxsKHRoaXMucGVuZGluZ0RyaXZlcnNbSW5uZXJEcml2ZXIubmFtZV0sIGRyaXZlckluc3RhbmNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYXR0YWNoVW5leHBlY3RlZFNodXRkb3duSGFuZGxlcihkcml2ZXJJbnN0YW5jZSwgaW5uZXJTZXNzaW9uSWQpO1xuXG4gICAgICBsb2cuaW5mbyhgTmV3ICR7SW5uZXJEcml2ZXIubmFtZX0gc2Vzc2lvbiBjcmVhdGVkIHN1Y2Nlc3NmdWxseSwgc2Vzc2lvbiBgICtcbiAgICAgICAgICAgICAgYCR7aW5uZXJTZXNzaW9uSWR9IGFkZGVkIHRvIG1hc3RlciBzZXNzaW9uIGxpc3RgKTtcblxuICAgICAgLy8gc2V0IHRoZSBOZXcgQ29tbWFuZCBUaW1lb3V0IGZvciB0aGUgaW5uZXIgZHJpdmVyXG4gICAgICBkcml2ZXJJbnN0YW5jZS5zdGFydE5ld0NvbW1hbmRUaW1lb3V0KCk7XG5cbiAgICAgIC8vIGFwcGx5IGluaXRpYWwgdmFsdWVzIHRvIEFwcGl1bSBzZXR0aW5ncyAoaWYgcHJvdmlkZWQpXG4gICAgICBpZiAoZHJpdmVySW5zdGFuY2UuaXNXM0NQcm90b2NvbCgpICYmICFfLmlzRW1wdHkodzNjU2V0dGluZ3MpKSB7XG4gICAgICAgIGxvZy5pbmZvKGBBcHBseWluZyB0aGUgaW5pdGlhbCB2YWx1ZXMgdG8gQXBwaXVtIHNldHRpbmdzIHBhcnNlZCBmcm9tIFczQyBjYXBzOiBgICtcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh3M2NTZXR0aW5ncykpO1xuICAgICAgICBhd2FpdCBkcml2ZXJJbnN0YW5jZS51cGRhdGVTZXR0aW5ncyh3M2NTZXR0aW5ncyk7XG4gICAgICB9IGVsc2UgaWYgKGRyaXZlckluc3RhbmNlLmlzTWpzb253cFByb3RvY29sKCkgJiYgIV8uaXNFbXB0eShqd3BTZXR0aW5ncykpIHtcbiAgICAgICAgbG9nLmluZm8oYEFwcGx5aW5nIHRoZSBpbml0aWFsIHZhbHVlcyB0byBBcHBpdW0gc2V0dGluZ3MgcGFyc2VkIGZyb20gTUpTT05XUCBjYXBzOiBgICtcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeShqd3BTZXR0aW5ncykpO1xuICAgICAgICBhd2FpdCBkcml2ZXJJbnN0YW5jZS51cGRhdGVTZXR0aW5ncyhqd3BTZXR0aW5ncyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBlcnJvcixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb3RvY29sLFxuICAgICAgdmFsdWU6IFtpbm5lclNlc3Npb25JZCwgZENhcHMsIHByb3RvY29sXVxuICAgIH07XG4gIH1cblxuICBhdHRhY2hVbmV4cGVjdGVkU2h1dGRvd25IYW5kbGVyIChkcml2ZXIsIGlubmVyU2Vzc2lvbklkKSB7XG4gICAgY29uc3QgcmVtb3ZlU2Vzc2lvbkZyb21NYXN0ZXJMaXN0ID0gKGNhdXNlID0gbmV3IEVycm9yKCdVbmtub3duIGVycm9yJykpID0+IHtcbiAgICAgIGxvZy53YXJuKGBDbG9zaW5nIHNlc3Npb24sIGNhdXNlIHdhcyAnJHtjYXVzZS5tZXNzYWdlfSdgKTtcbiAgICAgIGxvZy5pbmZvKGBSZW1vdmluZyBzZXNzaW9uICcke2lubmVyU2Vzc2lvbklkfScgZnJvbSBvdXIgbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvbnNbaW5uZXJTZXNzaW9uSWRdO1xuICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvblBsdWdpbnNbaW5uZXJTZXNzaW9uSWRdO1xuICAgIH07XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgIGlmIChfLmlzRnVuY3Rpb24oKGRyaXZlci5vblVuZXhwZWN0ZWRTaHV0ZG93biB8fCB7fSkudGhlbikpIHtcbiAgICAgIC8vIFRPRE86IFJlbW92ZSB0aGlzIGJsb2NrIGFmdGVyIGFsbCB0aGUgZHJpdmVycyB1c2UgYmFzZSBkcml2ZXIgYWJvdmUgdiA1LjAuMFxuICAgICAgLy8gUmVtb3ZlIHRoZSBzZXNzaW9uIG9uIHVuZXhwZWN0ZWQgc2h1dGRvd24sIHNvIHRoYXQgd2UgYXJlIGluIGEgcG9zaXRpb25cbiAgICAgIC8vIHRvIG9wZW4gYW5vdGhlciBzZXNzaW9uIGxhdGVyIG9uLlxuICAgICAgZHJpdmVyLm9uVW5leHBlY3RlZFNodXRkb3duXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyBpZiB3ZSBnZXQgaGVyZSwgd2UndmUgaGFkIGFuIHVuZXhwZWN0ZWQgc2h1dGRvd24sIHNvIGVycm9yXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIHNodXRkb3duJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgIC8vIGlmIHdlIGNhbmNlbGxlZCB0aGUgdW5leHBlY3RlZCBzaHV0ZG93biBwcm9taXNlLCB0aGF0IG1lYW5zIHdlXG4gICAgICAgICAgLy8gbm8gbG9uZ2VyIGNhcmUgYWJvdXQgaXQsIGFuZCBjYW4gc2FmZWx5IGlnbm9yZSBpdFxuICAgICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBCLkNhbmNlbGxhdGlvbkVycm9yKSkge1xuICAgICAgICAgICAgcmVtb3ZlU2Vzc2lvbkZyb21NYXN0ZXJMaXN0KGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7IC8vIHRoaXMgaXMgYSBjYW5jZWxsYWJsZSBwcm9taXNlXG4gICAgfSBlbHNlIGlmIChfLmlzRnVuY3Rpb24oZHJpdmVyLm9uVW5leHBlY3RlZFNodXRkb3duKSkge1xuICAgICAgLy8gc2luY2UgYmFzZSBkcml2ZXIgdiA1LjAuMFxuICAgICAgZHJpdmVyLm9uVW5leHBlY3RlZFNodXRkb3duKHJlbW92ZVNlc3Npb25Gcm9tTWFzdGVyTGlzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy53YXJuKGBGYWlsZWQgdG8gYXR0YWNoIHRoZSB1bmV4cGVjdGVkIHNodXRkb3duIGxpc3RlbmVyLiBgICtcbiAgICAgICAgYElzICdvblVuZXhwZWN0ZWRTaHV0ZG93bicgbWV0aG9kIGF2YWlsYWJsZSBmb3IgJyR7ZHJpdmVyLmNvbnN0cnVjdG9yLm5hbWV9Jz9gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjdXJTZXNzaW9uRGF0YUZvckRyaXZlciAoSW5uZXJEcml2ZXIpIHtcbiAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IHNlc3Npb25zTGlzdEd1YXJkLmFjcXVpcmUoQXBwaXVtRHJpdmVyLm5hbWUsICgpID0+IHRoaXMuc2Vzc2lvbnMpO1xuICAgIGNvbnN0IGRhdGEgPSBfLnZhbHVlcyhzZXNzaW9ucylcbiAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChzKSA9PiBzLmNvbnN0cnVjdG9yLm5hbWUgPT09IElubmVyRHJpdmVyLm5hbWUpXG4gICAgICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy5kcml2ZXJEYXRhKTtcbiAgICBmb3IgKGxldCBkYXR1bSBvZiBkYXRhKSB7XG4gICAgICBpZiAoIWRhdHVtKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgUHJvYmxlbSBnZXR0aW5nIHNlc3Npb24gZGF0YSBmb3IgZHJpdmVyIHR5cGUgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHtJbm5lckRyaXZlci5uYW1lfTsgZG9lcyBpdCBpbXBsZW1lbnQgJ2dldCBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBkcml2ZXJEYXRhJz9gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uIChzZXNzaW9uSWQpIHtcbiAgICBsZXQgcHJvdG9jb2w7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBvdGhlclNlc3Npb25zRGF0YSA9IG51bGw7XG4gICAgICBsZXQgZHN0U2Vzc2lvbiA9IG51bGw7XG4gICAgICBhd2FpdCBzZXNzaW9uc0xpc3RHdWFyZC5hY3F1aXJlKEFwcGl1bURyaXZlci5uYW1lLCAoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1ckNvbnN0cnVjdG9yTmFtZSA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXS5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICBvdGhlclNlc3Npb25zRGF0YSA9IF8udG9QYWlycyh0aGlzLnNlc3Npb25zKVxuICAgICAgICAgICAgICAuZmlsdGVyKChba2V5LCB2YWx1ZV0pID0+IHZhbHVlLmNvbnN0cnVjdG9yLm5hbWUgPT09IGN1ckNvbnN0cnVjdG9yTmFtZSAmJiBrZXkgIT09IHNlc3Npb25JZClcbiAgICAgICAgICAgICAgLm1hcCgoWywgdmFsdWVdKSA9PiB2YWx1ZS5kcml2ZXJEYXRhKTtcbiAgICAgICAgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICAgICAgcHJvdG9jb2wgPSBkc3RTZXNzaW9uLnByb3RvY29sO1xuICAgICAgICBsb2cuaW5mbyhgUmVtb3Zpbmcgc2Vzc2lvbiAke3Nlc3Npb25JZH0gZnJvbSBvdXIgbWFzdGVyIHNlc3Npb24gbGlzdGApO1xuICAgICAgICAvLyByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIGRlbGV0ZVNlc3Npb24gY29tcGxldGVzIHN1Y2Nlc3NmdWxseSBvciBub3RcbiAgICAgICAgLy8gbWFrZSB0aGUgc2Vzc2lvbiB1bmF2YWlsYWJsZSwgYmVjYXVzZSB3aG8ga25vd3Mgd2hhdCBzdGF0ZSBpdCBtaWdodFxuICAgICAgICAvLyBiZSBpbiBvdGhlcndpc2VcbiAgICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuc2Vzc2lvblBsdWdpbnNbc2Vzc2lvbklkXTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvdG9jb2wsXG4gICAgICAgIHZhbHVlOiBhd2FpdCBkc3RTZXNzaW9uLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkLCBvdGhlclNlc3Npb25zRGF0YSksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy5lcnJvcihgSGFkIHRyb3VibGUgZW5kaW5nIHNlc3Npb24gJHtzZXNzaW9uSWR9OiAke2UubWVzc2FnZX1gKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBlcnJvcjogZSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZGVsZXRlQWxsU2Vzc2lvbnMgKG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IHNlc3Npb25zQ291bnQgPSBfLnNpemUodGhpcy5zZXNzaW9ucyk7XG4gICAgaWYgKDAgPT09IHNlc3Npb25zQ291bnQpIHtcbiAgICAgIGxvZy5kZWJ1ZygnVGhlcmUgYXJlIG5vIGFjdGl2ZSBzZXNzaW9ucyBmb3IgY2xlYW51cCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgIGZvcmNlID0gZmFsc2UsXG4gICAgICByZWFzb24sXG4gICAgfSA9IG9wdHM7XG4gICAgbG9nLmRlYnVnKGBDbGVhbmluZyB1cCAke3V0aWwucGx1cmFsaXplKCdhY3RpdmUgc2Vzc2lvbicsIHNlc3Npb25zQ291bnQsIHRydWUpfWApO1xuICAgIGNvbnN0IGNsZWFudXBQcm9taXNlcyA9IGZvcmNlXG4gICAgICA/IF8udmFsdWVzKHRoaXMuc2Vzc2lvbnMpLm1hcCgoZHJ2KSA9PiBkcnYuc3RhcnRVbmV4cGVjdGVkU2h1dGRvd24ocmVhc29uICYmIG5ldyBFcnJvcihyZWFzb24pKSlcbiAgICAgIDogXy5rZXlzKHRoaXMuc2Vzc2lvbnMpLm1hcCgoaWQpID0+IHRoaXMuZGVsZXRlU2Vzc2lvbihpZCkpO1xuICAgIGZvciAoY29uc3QgY2xlYW51cFByb21pc2Ugb2YgY2xlYW51cFByb21pc2VzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBjbGVhbnVwUHJvbWlzZTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGFwcHJvcHJpYXRlIHBsdWdpbnMgZm9yIGEgc2Vzc2lvbiAob3Igc2Vzc2lvbmxlc3MgcGx1Z2lucylcbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfSBzZXNzaW9uSWQgLSB0aGUgc2Vzc2lvbklkIChvciBudWxsKSB0byB1c2UgdG8gZmluZCBwbHVnaW5zXG4gICAqIEByZXR1cm5zIHtBcnJheX0gLSBhcnJheSBvZiBwbHVnaW4gaW5zdGFuY2VzXG4gICAqL1xuICBwbHVnaW5zRm9yU2Vzc2lvbiAoc2Vzc2lvbklkID0gbnVsbCkge1xuICAgIGxldCBwbHVnaW5zID0gW107XG4gICAgaWYgKHNlc3Npb25JZCkge1xuICAgICAgaWYgKCF0aGlzLnNlc3Npb25QbHVnaW5zW3Nlc3Npb25JZF0pIHtcbiAgICAgICAgdGhpcy5zZXNzaW9uUGx1Z2luc1tzZXNzaW9uSWRdID0gdGhpcy5jcmVhdGVQbHVnaW5JbnN0YW5jZXMoKTtcbiAgICAgIH1cbiAgICAgIHBsdWdpbnMgPSB0aGlzLnNlc3Npb25QbHVnaW5zW3Nlc3Npb25JZF07XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChfLmlzRW1wdHkodGhpcy5zZXNzaW9ubGVzc1BsdWdpbnMpKSB7XG4gICAgICAgIHRoaXMuc2Vzc2lvbmxlc3NQbHVnaW5zID0gdGhpcy5jcmVhdGVQbHVnaW5JbnN0YW5jZXMoKTtcbiAgICAgIH1cbiAgICAgIHBsdWdpbnMgPSB0aGlzLnNlc3Npb25sZXNzUGx1Z2lucztcbiAgICB9XG4gICAgcmV0dXJuIHBsdWdpbnM7XG4gIH1cblxuICAvKipcbiAgICogVG8gZ2V0IHBsdWdpbnMgZm9yIGEgY29tbWFuZCwgd2UgZWl0aGVyIGdldCB0aGUgcGx1Z2luIGluc3RhbmNlcyBhc3NvY2lhdGVkIHdpdGggdGhlXG4gICAqIHBhcnRpY3VsYXIgY29tbWFuZCdzIHNlc3Npb24sIG9yIGluIHRoZSBjYXNlIG9mIHNlc3Npb25sZXNzIHBsdWdpbnMsIHB1bGwgZnJvbSB0aGUgc2V0IG9mXG4gICAqIHBsdWdpbiBpbnN0YW5jZXMgcmVzZXJ2ZWQgZm9yIHNlc3Npb25sZXNzIGNvbW1hbmRzIChhbmQgd2UgbGF6aWx5IGNyZWF0ZSBwbHVnaW4gaW5zdGFuY2VzIG9uXG4gICAqIGZpcnN0IHVzZSlcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNtZCAtIHRoZSBuYW1lIG9mIHRoZSBjb21tYW5kIHRvIGZpbmQgYSBwbHVnaW4gdG8gaGFuZGxlXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gc2Vzc2lvbklkIC0gdGhlIHBhcnRpY3VsYXIgc2Vzc2lvbiBmb3Igd2hpY2ggdG8gZmluZCBhIHBsdWdpbiwgb3IgbnVsbCBpZlxuICAgKiBzZXNzaW9ubGVzc1xuICAgKi9cbiAgcGx1Z2luc1RvSGFuZGxlQ21kIChjbWQsIHNlc3Npb25JZCA9IG51bGwpIHtcbiAgICAvLyB0byBoYW5kbGUgYSBnaXZlbiBjb21tYW5kLCBhIHBsdWdpbiBzaG91bGQgZWl0aGVyIGltcGxlbWVudCB0aGF0IGNvbW1hbmQgYXMgYSBwbHVnaW5cbiAgICAvLyBpbnN0YW5jZSBtZXRob2Qgb3IgaXQgc2hvdWxkIGltcGxlbWVudCBhIGdlbmVyaWMgJ2hhbmRsZScgbWV0aG9kXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luc0ZvclNlc3Npb24oc2Vzc2lvbklkKVxuICAgICAgLmZpbHRlcigocCkgPT4gXy5pc0Z1bmN0aW9uKHBbY21kXSkgfHwgXy5pc0Z1bmN0aW9uKHAuaGFuZGxlKSk7XG4gIH1cblxuICBjcmVhdGVQbHVnaW5JbnN0YW5jZXMgKHNlc3Npb25JZCkge1xuICAgIGlmICghc2Vzc2lvbklkKSB7XG4gICAgICBzZXNzaW9uSWQgPSAnc2Vzc2lvbmxlc3MnO1xuICAgIH1cbiAgICBzZXNzaW9uSWQgPSBfLnRydW5jYXRlKHNlc3Npb25JZCwge2xlbmd0aDogMTF9KTtcbiAgICByZXR1cm4gdGhpcy5wbHVnaW5DbGFzc2VzLm1hcCgoUGx1Z2luQ2xhc3MpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYWxOYW1lID0gUGx1Z2luQ2xhc3MucGx1Z2luTmFtZTtcbiAgICAgIGNvbnN0IG5hbWUgPSBgJHtnZW5lcmFsTmFtZX0gKCR7c2Vzc2lvbklkfSlgO1xuICAgICAgY29uc3QgcGx1Z2luID0gbmV3IFBsdWdpbkNsYXNzKG5hbWUpO1xuICAgICAgdGhpcy5hc3NpZ25DbGlBcmdzVG9FeHRlbnNpb24oJ3BsdWdpbicsIGdlbmVyYWxOYW1lLCBQbHVnaW5DbGFzcywgcGx1Z2luKTtcbiAgICAgIHJldHVybiBwbHVnaW47XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBleGVjdXRlQ29tbWFuZCAoY21kLCAuLi5hcmdzKSB7XG4gICAgLy8gV2UgaGF2ZSBiYXNpY2FsbHkgdGhyZWUgY2FzZXMgZm9yIGhvdyB0byBoYW5kbGUgY29tbWFuZHM6XG4gICAgLy8gMS4gaGFuZGxlIGdldFN0YXR1cyAod2UgZG8gdGhpcyBhcyBhIHNwZWNpYWwgb3V0IG9mIGJhbmQgY2FzZSBzbyBpdCBkb2Vzbid0IGdldCBhZGRlZCB0byBhblxuICAgIC8vICAgIGV4ZWN1dGlvbiBxdWV1ZSwgYW5kIGNhbiBiZSBjYWxsZWQgd2hpbGUgZS5nLiBjcmVhdGVTZXNzaW9uIGlzIGluIHByb2dyZXNzKVxuICAgIC8vIDIuIGhhbmRsZSBjb21tYW5kcyB0aGF0IHRoaXMgdW1icmVsbGEgZHJpdmVyIHNob3VsZCBoYW5kbGUsIHJhdGhlciB0aGFuIHRoZSBhY3R1YWwgc2Vzc2lvblxuICAgIC8vICAgIGRyaXZlciAoZm9yIGV4YW1wbGUsIGRlbGV0ZVNlc3Npb24sIG9yIG90aGVyIG5vbi1zZXNzaW9uIGNvbW1hbmRzKVxuICAgIC8vIDMuIGhhbmRsZSBzZXNzaW9uIGRyaXZlciBjb21tYW5kcy5cbiAgICAvLyBUaGUgdHJpY2t5IHBhcnQgaXMgdGhhdCBiZWNhdXNlIHdlIHN1cHBvcnQgY29tbWFuZCBwbHVnaW5zLCB3ZSBuZWVkIHRvIHdyYXAgYW55IG9mIHRoZXNlXG4gICAgLy8gY2FzZXMgd2l0aCBwbHVnaW4gaGFuZGxpbmcuXG5cbiAgICBjb25zdCBpc0dldFN0YXR1cyA9IGNtZCA9PT0gJ2dldFN0YXR1cyc7XG4gICAgY29uc3QgaXNVbWJyZWxsYUNtZCA9ICFpc0dldFN0YXR1cyAmJiBpc0FwcGl1bURyaXZlckNvbW1hbmQoY21kKTtcbiAgICBjb25zdCBpc1Nlc3Npb25DbWQgPSAhaXNHZXRTdGF0dXMgJiYgIWlzVW1icmVsbGFDbWQ7XG5cbiAgICAvLyBmaXJzdCBkbyBzb21lIGVycm9yIGNoZWNraW5nLiBJZiB3ZSdyZSByZXF1ZXN0aW5nIGEgc2Vzc2lvbiBjb21tYW5kIGV4ZWN1dGlvbiwgdGhlbiBtYWtlXG4gICAgLy8gc3VyZSB0aGF0IHNlc3Npb24gYWN0dWFsbHkgZXhpc3RzIG9uIHRoZSBzZXNzaW9uIGRyaXZlciwgYW5kIHNldCB0aGUgc2Vzc2lvbiBkcml2ZXIgaXRzZWxmXG4gICAgbGV0IHNlc3Npb25JZCA9IG51bGw7XG4gICAgbGV0IGRzdFNlc3Npb24gPSBudWxsO1xuICAgIGxldCBwcm90b2NvbCA9IG51bGw7XG4gICAgbGV0IGRyaXZlciA9IHRoaXM7XG4gICAgaWYgKGlzU2Vzc2lvbkNtZCkge1xuICAgICAgc2Vzc2lvbklkID0gXy5sYXN0KGFyZ3MpO1xuICAgICAgZHN0U2Vzc2lvbiA9IGF3YWl0IHNlc3Npb25zTGlzdEd1YXJkLmFjcXVpcmUoQXBwaXVtRHJpdmVyLm5hbWUsICgpID0+IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXSk7XG4gICAgICBpZiAoIWRzdFNlc3Npb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgc2Vzc2lvbiB3aXRoIGlkICcke3Nlc3Npb25JZH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgICB9XG4gICAgICAvLyBub3cgc2F2ZSB0aGUgcmVzcG9uc2UgcHJvdG9jb2wgZ2l2ZW4gdGhhdCB0aGUgc2Vzc2lvbiBkcml2ZXIncyBwcm90b2NvbCBtaWdodCBkaWZmZXJcbiAgICAgIHByb3RvY29sID0gZHN0U2Vzc2lvbi5wcm90b2NvbDtcbiAgICAgIGRyaXZlciA9IGRzdFNlc3Npb247XG4gICAgfVxuXG4gICAgLy8gZ2V0IGFueSBwbHVnaW5zIHdoaWNoIGFyZSByZWdpc3RlcmVkIGFzIGhhbmRsaW5nIHRoaXMgY29tbWFuZFxuICAgIGNvbnN0IHBsdWdpbnMgPSB0aGlzLnBsdWdpbnNUb0hhbmRsZUNtZChjbWQsIHNlc3Npb25JZCk7XG5cbiAgICAvLyBub3cgd2UgZGVmaW5lIGEgJ2NtZEhhbmRsZWRCeScgb2JqZWN0IHdoaWNoIHdpbGwga2VlcCB0cmFjayBvZiB3aGljaCBwbHVnaW5zIGhhdmUgaGFuZGxlZCB0aGlzXG4gICAgLy8gY29tbWFuZC4gd2UgY2FyZSBhYm91dCB0aGlzIGJlY2F1c2UgKGEpIG11bHRpcGxlIHBsdWdpbnMgY2FuIGhhbmRsZSB0aGUgc2FtZSBjb21tYW5kLCBhbmRcbiAgICAvLyAoYikgdGhlcmUncyBubyBndWFyYW50ZWUgdGhhdCBhIHBsdWdpbiB3aWxsIGFjdHVhbGx5IGNhbGwgdGhlIG5leHQoKSBtZXRob2Qgd2hpY2ggcnVucyB0aGVcbiAgICAvLyBvcmlnaW5hbCBjb21tYW5kIGV4ZWN1dGlvbi4gVGhpcyByZXN1bHRzIGluIGEgc2l0dWF0aW9uIHdoZXJlIHRoZSBjb21tYW5kIG1pZ2h0IGJlIGhhbmRsZWRcbiAgICAvLyBieSBzb21lIGJ1dCBub3QgYWxsIHBsdWdpbnMsIG9yIGJ5IHBsdWdpbihzKSBidXQgbm90IGJ5IHRoZSBkZWZhdWx0IGJlaGF2aW9yLiBTbyBzdGFydCBvdXRcbiAgICAvLyB0aGlzIG9iamVjdCBkZWNsYXJpbmcgdGhhdCB0aGUgZGVmYXVsdCBoYW5kbGVyIGhhcyBub3QgYmVlbiBleGVjdXRlZC5cbiAgICBjb25zdCBjbWRIYW5kbGVkQnkgPSB7ZGVmYXVsdDogZmFsc2V9O1xuXG4gICAgLy8gbm93IHdlIGRlZmluZSBhbiBhc3luYyBmdW5jdGlvbiB3aGljaCB3aWxsIGJlIHBhc3NlZCB0byBwbHVnaW5zLCBhbmQgc3VjY2Vzc2l2ZWx5IHdyYXBwZWRcbiAgICAvLyBpZiB0aGVyZSBpcyBtb3JlIHRoYW4gb25lIHBsdWdpbiB0aGF0IGNhbiBoYW5kbGUgdGhlIGNvbW1hbmQuIFRvIHN0YXJ0IG9mZiB3aXRoLCB0aGUgYXN5bmNcbiAgICAvLyBmdW5jdGlvbiBpcyBkZWZpbmVkIGFzIGNhbGxpbmcgdGhlIGRlZmF1bHQgYmVoYXZpb3IsIGkuZS4sIHdoaWNoZXZlciBvZiB0aGUgMyBjYXNlcyBhYm92ZSBpc1xuICAgIC8vIHRoZSBhcHByb3ByaWF0ZSBvbmVcbiAgICBjb25zdCBkZWZhdWx0QmVoYXZpb3IgPSBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBpZiB3ZSdyZSBydW5uaW5nIHdpdGggcGx1Z2lucywgbWFrZSBzdXJlIHdlIGxvZyB0aGF0IHRoZSBkZWZhdWx0IGJlaGF2aW9yIGlzIGFjdHVhbGx5XG4gICAgICAvLyBoYXBwZW5pbmcgc28gd2UgY2FuIHRlbGwgd2hlbiB0aGUgcGx1Z2luIGNhbGwgY2hhaW4gaXMgdW53cmFwcGluZyB0byB0aGUgZGVmYXVsdCBiZWhhdmlvclxuICAgICAgLy8gaWYgdGhhdCdzIHdoYXQgaGFwcGVuc1xuICAgICAgcGx1Z2lucy5sZW5ndGggJiYgbG9nLmluZm8oYEV4ZWN1dGluZyBkZWZhdWx0IGhhbmRsaW5nIGJlaGF2aW9yIGZvciBjb21tYW5kICcke2NtZH0nYCk7XG5cbiAgICAgIC8vIGlmIHdlIG1ha2UgaXQgaGVyZSwgd2Uga25vdyB0aGF0IHRoZSBkZWZhdWx0IGJlaGF2aW9yIGlzIGhhbmRsZWRcbiAgICAgIGNtZEhhbmRsZWRCeS5kZWZhdWx0ID0gdHJ1ZTtcblxuICAgICAgaWYgKGlzR2V0U3RhdHVzKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFN0YXR1cygpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNVbWJyZWxsYUNtZCkge1xuICAgICAgICAvLyBzb21lIGNvbW1hbmRzLCBsaWtlIGRlbGV0ZVNlc3Npb24sIHdlIHdhbnQgdG8gbWFrZSBzdXJlIHRvIGhhbmRsZSBvbiAqdGhpcyogZHJpdmVyLFxuICAgICAgICAvLyBub3QgdGhlIHBsYXRmb3JtIGRyaXZlclxuICAgICAgICByZXR1cm4gYXdhaXQgc3VwZXIuZXhlY3V0ZUNvbW1hbmQoY21kLCAuLi5hcmdzKTtcbiAgICAgIH1cblxuICAgICAgLy8gaGVyZSB3ZSBrbm93IHRoYXQgd2UgYXJlIGV4ZWN1dGluZyBhIHNlc3Npb24gY29tbWFuZCwgYW5kIGhhdmUgYSB2YWxpZCBzZXNzaW9uIGRyaXZlclxuICAgICAgcmV0dXJuIGF3YWl0IGRzdFNlc3Npb24uZXhlY3V0ZUNvbW1hbmQoY21kLCAuLi5hcmdzKTtcbiAgICB9O1xuXG4gICAgLy8gbm93IHRha2Ugb3VyIGRlZmF1bHQgYmVoYXZpb3IsIHdyYXAgaXQgd2l0aCBhbnkgbnVtYmVyIG9mIHBsdWdpbiBiZWhhdmlvcnMsIGFuZCBydW4gaXRcbiAgICBjb25zdCB3cmFwcGVkQ21kID0gdGhpcy53cmFwQ29tbWFuZFdpdGhQbHVnaW5zKHtcbiAgICAgIGRyaXZlciwgY21kLCBhcmdzLCBwbHVnaW5zLCBjbWRIYW5kbGVkQnksIG5leHQ6IGRlZmF1bHRCZWhhdmlvclxuICAgIH0pO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZVdyYXBwZWRDb21tYW5kKHt3cmFwcGVkQ21kLCBwcm90b2NvbH0pO1xuXG4gICAgLy8gaWYgd2UgaGFkIHBsdWdpbnMsIG1ha2Ugc3VyZSB0byBsb2cgb3V0IHRoZSBoZWxwZnVsIHJlcG9ydCBhYm91dCB3aGljaCBwbHVnaW5zIGVuZGVkIHVwXG4gICAgLy8gaGFuZGxpbmcgdGhlIGNvbW1hbmQgYW5kIHdoaWNoIGRpZG4ndFxuICAgIHBsdWdpbnMubGVuZ3RoICYmIHRoaXMubG9nUGx1Z2luSGFuZGxlclJlcG9ydCh7Y21kLCBjbWRIYW5kbGVkQnl9KTtcblxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICB3cmFwQ29tbWFuZFdpdGhQbHVnaW5zICh7ZHJpdmVyLCBjbWQsIGFyZ3MsIG5leHQsIGNtZEhhbmRsZWRCeSwgcGx1Z2luc30pIHtcbiAgICBwbHVnaW5zLmxlbmd0aCAmJiBsb2cuaW5mbyhgUGx1Z2lucyB3aGljaCBjYW4gaGFuZGxlIGNtZCAnJHtjbWR9JzogJHtwbHVnaW5zLm1hcCgocCkgPT4gcC5uYW1lKX1gKTtcblxuICAgIC8vIG5vdyB3ZSBjYW4gZ28gdGhyb3VnaCBlYWNoIHBsdWdpbiBhbmQgd3JhcCBgbmV4dGAgYXJvdW5kIGl0cyBvd24gaGFuZGxlciwgcGFzc2luZyB0aGUgKm9sZCpcbiAgICAvLyBuZXh0IGluIHNvIHRoYXQgaXQgY2FuIGNhbGwgaXQgaWYgaXQgd2FudHMgdG9cbiAgICBmb3IgKGNvbnN0IHBsdWdpbiBvZiBwbHVnaW5zKSB7XG4gICAgICAvLyBuZWVkIGFuIElJRkUgaGVyZSBiZWNhdXNlIHdlIHdhbnQgdGhlIHZhbHVlIG9mIG5leHQgdGhhdCdzIHBhc3NlZCB0byBwbHVnaW4uaGFuZGxlIHRvIGJlXG4gICAgICAvLyBleGFjdGx5IHRoZSB2YWx1ZSBvZiBuZXh0IGhlcmUgYmVmb3JlIHJlYXNzaWdubWVudDsgd2UgZG9uJ3Qgd2FudCBpdCB0byBiZSBsYXppbHlcbiAgICAgIC8vIGV2YWx1YXRlZCwgb3RoZXJ3aXNlIHdlIGVuZCB1cCB3aXRoIGluZmluaXRlIHJlY3Vyc2lvbiBvZiB0aGUgbGFzdCBgbmV4dGAgdG8gYmUgZGVmaW5lZC5cbiAgICAgIGNtZEhhbmRsZWRCeVtwbHVnaW4ubmFtZV0gPSBmYWxzZTsgLy8gd2Ugc2VlIGEgbmV3IHBsdWdpbiwgc28gYWRkIGl0IHRvIHRoZSAnY21kSGFuZGxlZEJ5JyBvYmplY3RcbiAgICAgIG5leHQgPSAoKF9uZXh0KSA9PiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxvZy5pbmZvKGBQbHVnaW4gJHtwbHVnaW4ubmFtZX0gaXMgbm93IGhhbmRsaW5nIGNtZCAnJHtjbWR9J2ApO1xuICAgICAgICBjbWRIYW5kbGVkQnlbcGx1Z2luLm5hbWVdID0gdHJ1ZTsgLy8gaWYgd2UgbWFrZSBpdCBoZXJlLCB0aGlzIHBsdWdpbiBoYXMgYXR0ZW1wdGVkIHRvIGhhbmRsZSBjbWRcbiAgICAgICAgLy8gZmlyc3QgYXR0ZW1wdCB0byBoYW5kbGUgdGhlIGNvbW1hbmQgdmlhIGEgY29tbWFuZC1zcGVjaWZpYyBoYW5kbGVyIG9uIHRoZSBwbHVnaW5cbiAgICAgICAgaWYgKHBsdWdpbltjbWRdKSB7XG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHBsdWdpbltjbWRdKF9uZXh0LCBkcml2ZXIsIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIC8vIG90aGVyd2lzZSwgY2FsbCB0aGUgZ2VuZXJpYyAnaGFuZGxlJyBtZXRob2RcbiAgICAgICAgcmV0dXJuIGF3YWl0IHBsdWdpbi5oYW5kbGUoX25leHQsIGRyaXZlciwgY21kLCAuLi5hcmdzKTtcbiAgICAgIH0pKG5leHQpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXh0O1xuICB9XG5cbiAgbG9nUGx1Z2luSGFuZGxlclJlcG9ydCAoe2NtZCwgY21kSGFuZGxlZEJ5fSkge1xuICAgIC8vIGF0IHRoZSBlbmQgb2YgdGhlIGRheSwgd2UgaGF2ZSBhbiBvYmplY3QgcmVwcmVzZW50aW5nIHdoaWNoIHBsdWdpbnMgZW5kZWQgdXAgZ2V0dGluZ1xuICAgIC8vIHRoZWlyIGNvZGUgcnVuIGFzIHBhcnQgb2YgaGFuZGxpbmcgdGhpcyBjb21tYW5kLiBCZWNhdXNlIHBsdWdpbnMgY2FuIGNob29zZSAqbm90KiB0b1xuICAgIC8vIHBhc3MgY29udHJvbCB0byBvdGhlciBwbHVnaW5zIG9yIHRvIHRoZSBkZWZhdWx0IGRyaXZlciBiZWhhdmlvciwgdGhpcyBpcyBpbmZvcm1hdGlvblxuICAgIC8vIHdoaWNoIGlzIHByb2JhYmx5IHVzZWZ1bCB0byB0aGUgdXNlciAoZXNwZWNpYWxseSBpbiBzaXR1YXRpb25zIHdoZXJlIHBsdWdpbnMgbWlnaHQgbm90XG4gICAgLy8gaW50ZXJhY3Qgd2VsbCB0b2dldGhlciwgYW5kIGl0IHdvdWxkIGJlIGhhcmQgdG8gZGVidWcgb3RoZXJ3aXNlIHdpdGhvdXQgdGhpcyBraW5kIG9mXG4gICAgLy8gbWVzc2FnZSkuXG4gICAgY29uc3QgZGlkSGFuZGxlID0gT2JqZWN0LmtleXMoY21kSGFuZGxlZEJ5KS5maWx0ZXIoKGspID0+IGNtZEhhbmRsZWRCeVtrXSk7XG4gICAgY29uc3QgZGlkbnRIYW5kbGUgPSBPYmplY3Qua2V5cyhjbWRIYW5kbGVkQnkpLmZpbHRlcigoaykgPT4gIWNtZEhhbmRsZWRCeVtrXSk7XG4gICAgaWYgKGRpZG50SGFuZGxlLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZy5pbmZvKGBDb21tYW5kICcke2NtZH0nIHdhcyBub3QgaGFuZGxlZCBieSB0aGUgZm9sbG93aW5nIGJlYWh2aW9ycyBvciBwbHVnaW5zLCBldmVuIGAgK1xuICAgICAgICAgICAgICAgYHRob3VnaCB0aGV5IHdlcmUgcmVnaXN0ZXJlZCB0byBoYW5kbGUgaXQ6ICR7SlNPTi5zdHJpbmdpZnkoZGlkbnRIYW5kbGUpfS4gVGhlIGAgK1xuICAgICAgICAgICAgICAgYGNvbW1hbmQgKndhcyogaGFuZGxlZCBieSB0aGVzZTogJHtKU09OLnN0cmluZ2lmeShkaWRIYW5kbGUpfS5gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBleGVjdXRlV3JhcHBlZENvbW1hbmQgKHt3cmFwcGVkQ21kLCBwcm90b2NvbH0pIHtcbiAgICBsZXQgY21kUmVzLCBjbWRFcnIsIHJlcyA9IHt9O1xuICAgIHRyeSB7XG4gICAgICAvLyBBdCB0aGlzIHBvaW50LCBgd3JhcHBlZENtZGAgZGVmaW5lcyBhIHdob2xlIHNlcXVlbmNlIG9mIHBsdWdpbiBoYW5kbGVycywgY3VsbWluYXRpbmcgaW5cbiAgICAgIC8vIG91ciBkZWZhdWx0IGhhbmRsZXIuIFdoYXRldmVyIGl0IHJldHVybnMgaXMgd2hhdCB3ZSdyZSBnb2luZyB0byB3YW50IHRvIHNlbmQgYmFjayB0byB0aGVcbiAgICAgIC8vIHVzZXIuXG4gICAgICBjbWRSZXMgPSBhd2FpdCB3cmFwcGVkQ21kKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY21kRXJyID0gZTtcbiAgICB9XG5cbiAgICAvLyBTYWRseSwgd2UgZG9uJ3Qga25vdyBleGFjdGx5IHdoYXQga2luZCBvZiBvYmplY3Qgd2lsbCBiZSByZXR1cm5lZC4gSXQgd2lsbCBlaXRoZXIgYmUgYSBiYXJlXG4gICAgLy8gb2JqZWN0LCBvciBhIHByb3RvY29sLWF3YXJlIG9iamVjdCB3aXRoIHByb3RvY29sIGFuZCBlcnJvci92YWx1ZSBrZXlzLiBTbyB3ZSBuZWVkIHRvIHNuaWZmXG4gICAgLy8gaXQgYW5kIG1ha2Ugc3VyZSB3ZSBkb24ndCBkb3VibGUtd3JhcCBpdCBpZiBpdCdzIHRoZSBsYXR0ZXIga2luZC5cbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGNtZFJlcykgJiYgXy5oYXMoY21kUmVzLCAncHJvdG9jb2wnKSkge1xuICAgICAgcmVzID0gY21kUmVzO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMudmFsdWUgPSBjbWRSZXM7XG4gICAgICByZXMuZXJyb3IgPSBjbWRFcnI7XG4gICAgICByZXMucHJvdG9jb2wgPSBwcm90b2NvbDtcbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIC8vIFdlIHdhbnQgdG8gb3ZlcnJpZGUgYmFzZWRyaXZlcidzIHByb3h5IGF2b2lkYW5jZSBkZXRlY3Rpb24gc2luY2UgcGx1Z2lucyBtaWdodCB3YW50IHRvIGF2b2lkXG4gIC8vIHByb3h5aW5nIGluIG9yZGVyIHRvIGhhbmRsZSBhIGNvbW1hbmQsIHNvIHdlIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIG1ha2UgYW4gZXh0cmEgY2hlY2sgd2hldGhlclxuICAvLyBwbHVnaW5zIG1pZ2h0IHdhbnQgdG8gZG8gdGhpcy5cbiAgcHJveHlSb3V0ZUlzQXZvaWRlZCAoc2Vzc2lvbklkLCBtZXRob2QsIHVybCwgYm9keSkge1xuICAgIGlmIChzdXBlci5wcm94eVJvdXRlSXNBdm9pZGVkKHNlc3Npb25JZCwgbWV0aG9kLCB1cmwsIGJvZHkpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLy8gaWYgZXZlbiBqdXN0IG9uZSBwbHVnaW4gbmVlZHMgdG8gYXZvaWQgcHJveHlpbmcsIGRvIHNvXG4gICAgZm9yIChjb25zdCBwbHVnaW4gb2YgdGhpcy5wbHVnaW5zRm9yU2Vzc2lvbihzZXNzaW9uSWQpKSB7XG4gICAgICBpZiAocGx1Z2luLnNob3VsZEF2b2lkUHJveHk/LihtZXRob2QsIHVybCwgYm9keSkpIHtcbiAgICAgICAgbG9nLmluZm8oYFJlcXVlc3QgdG8gJHt1cmx9IHdvdWxkIG5vcm1hbGx5IGJlIHByb3hpZWQsIGJ1dCBwbHVnaW4gJHtwbHVnaW4ubmFtZX0gd2FudHMgYCArXG4gICAgICAgICAgICAgICAgIGB0byBoYW5kbGUgaXQgaW50ZXJuYWxseS4gV2UnbGwgYXZvaWQgcHJveHlpbmcgaW4gdGhpcyBjYXNlLmApO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJveHlBY3RpdmUgKHNlc3Npb25JZCkge1xuICAgIGNvbnN0IGRzdFNlc3Npb24gPSB0aGlzLnNlc3Npb25zW3Nlc3Npb25JZF07XG4gICAgcmV0dXJuIGRzdFNlc3Npb24gJiYgXy5pc0Z1bmN0aW9uKGRzdFNlc3Npb24ucHJveHlBY3RpdmUpICYmIGRzdFNlc3Npb24ucHJveHlBY3RpdmUoc2Vzc2lvbklkKTtcbiAgfVxuXG4gIGdldFByb3h5QXZvaWRMaXN0IChzZXNzaW9uSWQpIHtcbiAgICBjb25zdCBkc3RTZXNzaW9uID0gdGhpcy5zZXNzaW9uc1tzZXNzaW9uSWRdO1xuICAgIHJldHVybiBkc3RTZXNzaW9uID8gZHN0U2Vzc2lvbi5nZXRQcm94eUF2b2lkTGlzdCgpIDogW107XG4gIH1cblxuICBjYW5Qcm94eSAoc2Vzc2lvbklkKSB7XG4gICAgY29uc3QgZHN0U2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnNbc2Vzc2lvbklkXTtcbiAgICByZXR1cm4gZHN0U2Vzc2lvbiAmJiBkc3RTZXNzaW9uLmNhblByb3h5KHNlc3Npb25JZCk7XG4gIH1cbn1cblxuLy8gaGVscCBkZWNpZGUgd2hpY2ggY29tbWFuZHMgc2hvdWxkIGJlIHByb3hpZWQgdG8gc3ViLWRyaXZlcnMgYW5kIHdoaWNoXG4vLyBzaG91bGQgYmUgaGFuZGxlZCBieSB0aGlzLCBvdXIgdW1icmVsbGEgZHJpdmVyXG5mdW5jdGlvbiBpc0FwcGl1bURyaXZlckNvbW1hbmQgKGNtZCkge1xuICByZXR1cm4gIWlzU2Vzc2lvbkNvbW1hbmQoY21kKSB8fCBjbWQgPT09ICdkZWxldGVTZXNzaW9uJztcbn1cblxuZXhwb3J0IHsgQXBwaXVtRHJpdmVyIH07XG4iXSwiZmlsZSI6ImxpYi9hcHBpdW0uanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
