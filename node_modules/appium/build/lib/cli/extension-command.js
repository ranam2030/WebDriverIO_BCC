"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _npm = _interopRequireDefault(require("./npm"));

var _path = _interopRequireDefault(require("path"));

var _support = require("@appium/support");

var _utils = require("./utils");

var _teen_process = require("teen_process");

var _extensionConfig = require("../extension-config");

const UPDATE_ALL = 'installed';

class NotUpdatableError extends Error {}

class NoUpdatesAvailableError extends Error {}

class ExtensionCommand {
  constructor({
    config,
    json,
    type
  }) {
    this.config = config;
    this.type = type;
    this.isJsonOutput = json;
    this.npm = new _npm.default(this.config.appiumHome);
    this.knownExtensions = {};
  }

  async execute(args) {
    const cmd = args[`${this.type}Command`];

    if (!_lodash.default.isFunction(ExtensionCommand.prototype[cmd])) {
      throw new Error(`Cannot handle ${this.type} command ${cmd}`);
    }

    const executeCmd = this[cmd].bind(this);
    return await executeCmd(args);
  }

  async list({
    showInstalled,
    showUpdates
  }) {
    const lsMsg = `Listing ${showInstalled ? 'installed' : 'available'} ${this.type}s`;
    const installedNames = Object.keys(this.config.installedExtensions);
    const knownNames = Object.keys(this.knownExtensions);
    const exts = [...installedNames, ...knownNames].reduce((acc, name) => {
      if (!acc[name]) {
        if (installedNames.includes(name)) {
          acc[name] = { ...this.config.installedExtensions[name],
            installed: true
          };
        } else if (!showInstalled) {
          acc[name] = {
            pkgName: this.knownExtensions[name],
            installed: false
          };
        }
      }

      return acc;
    }, {});
    await (0, _utils.spinWith)(this.isJsonOutput, lsMsg, async () => {
      if (!showUpdates) {
        return;
      }

      for (const [ext, data] of _lodash.default.toPairs(exts)) {
        const {
          installed,
          installType
        } = data;

        if (!installed || installType !== _extensionConfig.INSTALL_TYPE_NPM) {
          continue;
        }

        const updates = await this.checkForExtensionUpdate(ext);
        data.updateVersion = updates.safeUpdate;
        data.unsafeUpdateVersion = updates.unsafeUpdate;
        data.upToDate = updates.safeUpdate === null && updates.unsafeUpdate === null;
      }
    });

    if (this.isJsonOutput) {
      return exts;
    }

    for (const [name, {
      installType,
      installSpec,
      installed,
      updateVersion,
      unsafeUpdateVersion,
      version,
      upToDate
    }] of _lodash.default.toPairs(exts)) {
      let typeTxt;

      switch (installType) {
        case _extensionConfig.INSTALL_TYPE_GIT:
        case _extensionConfig.INSTALL_TYPE_GITHUB:
          typeTxt = `(cloned from ${installSpec})`.yellow;
          break;

        case _extensionConfig.INSTALL_TYPE_LOCAL:
          typeTxt = `(linked from ${installSpec})`.magenta;
          break;

        default:
          typeTxt = '(NPM)';
      }

      const installTxt = installed ? `@${version.yellow} ${('[installed ' + typeTxt + ']').green}` : ' [not installed]'.grey;
      const updateTxt = showUpdates && updateVersion ? ` [${updateVersion} available]`.magenta : '';
      const upToDateTxt = showUpdates && upToDate ? ` [Up to date]`.green : '';
      const unsafeUpdateTxt = showUpdates && unsafeUpdateVersion ? ` [${unsafeUpdateVersion} available (potentially unsafe)]`.cyan : '';
      console.log(`- ${name.yellow}${installTxt}${updateTxt}${upToDateTxt}${unsafeUpdateTxt}`);
    }

    return exts;
  }

  async install({
    ext,
    installType,
    packageName
  }) {
    (0, _utils.log)(this.isJsonOutput, `Attempting to find and install ${this.type} '${ext}'`);
    let extData;
    let installSpec = ext;

    if (packageName && [_extensionConfig.INSTALL_TYPE_LOCAL, _extensionConfig.INSTALL_TYPE_NPM].includes(installType)) {
      throw new Error(`When using --source=${installType}, cannot also use --package`);
    }

    if (!packageName && [_extensionConfig.INSTALL_TYPE_GIT, _extensionConfig.INSTALL_TYPE_GITHUB].includes(installType)) {
      throw new Error(`When using --source=${installType}, must also use --package`);
    }

    if (installType === _extensionConfig.INSTALL_TYPE_LOCAL) {
      const msg = `Linking ${this.type} from local path`;
      const pkgJsonData = await (0, _utils.spinWith)(this.isJsonOutput, msg, async () => await this.npm.linkPackage(installSpec));
      extData = this.getExtensionFields(pkgJsonData);
      extData.installPath = extData.pkgName;
    } else if (installType === _extensionConfig.INSTALL_TYPE_GITHUB) {
      if (installSpec.split('/').length !== 2) {
        throw new Error(`Github ${this.type} spec ${installSpec} appeared to be invalid; ` + 'it should be of the form <org>/<repo>');
      }

      extData = await this.installViaNpm({
        ext: installSpec,
        pkgName: packageName
      });
    } else if (installType === _extensionConfig.INSTALL_TYPE_GIT) {
      installSpec = installSpec.replace(/\.git$/, '');
      extData = await this.installViaNpm({
        ext: installSpec,
        pkgName: packageName
      });
    } else {
      let name, pkgVer;
      const splits = installSpec.split('@');

      if (installSpec[0] === '@') {
        [name, pkgVer] = [`@${splits[1]}`, splits[2]];
      } else {
        [name, pkgVer] = splits;
      }

      let pkgName;

      if (installType === _extensionConfig.INSTALL_TYPE_NPM) {
        pkgName = name;
      } else {
        const knownNames = Object.keys(this.knownExtensions);

        if (!_lodash.default.includes(knownNames, name)) {
          const msg = `Could not resolve ${this.type}; are you sure it's in the list ` + `of supported ${this.type}s? ${JSON.stringify(knownNames)}`;
          throw new Error(msg);
        }

        pkgName = this.knownExtensions[name];
        installType = _extensionConfig.INSTALL_TYPE_NPM;
      }

      extData = await this.installViaNpm({
        ext,
        pkgName,
        pkgVer
      });
    }

    const extName = extData[`${this.type}Name`];
    delete extData[`${this.type}Name`];

    if (this.config.isInstalled(extName)) {
      throw new Error(`A ${this.type} named '${extName}' is already installed. ` + `Did you mean to update? 'appium ${this.type} update'. See ` + `installed ${this.type}s with 'appium ${this.type} list --installed'.`);
    }

    extData.installType = installType;
    extData.installSpec = installSpec;
    await this.config.addExtension(extName, extData);
    (0, _utils.log)(this.isJsonOutput, this.getPostInstallText({
      extName,
      extData
    }));
    return this.config.installedExtensions;
  }

  async installViaNpm({
    ext,
    pkgName,
    pkgVer
  }) {
    const npmSpec = `${pkgName}${pkgVer ? '@' + pkgVer : ''}`;
    const specMsg = npmSpec === ext ? '' : ` using NPM install spec '${npmSpec}'`;
    const msg = `Installing '${ext}'${specMsg}`;

    try {
      const pkgJsonData = await (0, _utils.spinWith)(this.isJsonOutput, msg, async () => await this.npm.installPackage({
        pkgDir: _path.default.resolve(this.config.appiumHome, pkgName),
        pkgName,
        pkgVer
      }));
      const extData = this.getExtensionFields(pkgJsonData);
      extData.installPath = pkgName;
      return extData;
    } catch (err) {
      throw new Error(`Encountered an error when installing package: ${err.message}`);
    }
  }

  getPostInstallText() {
    throw new Error('Must be implemented in final class');
  }

  getExtensionFields(pkgJsonData) {
    if (!pkgJsonData.appium) {
      throw new Error(`Installed driver did not have an 'appium' section in its ` + `package.json file as expected`);
    }

    const {
      appium,
      name,
      version
    } = pkgJsonData;
    this.validateExtensionFields(appium);
    return { ...appium,
      pkgName: name,
      version
    };
  }

  validateExtensionFields() {
    throw new Error('Must be implemented in final class');
  }

  async uninstall({
    ext
  }) {
    if (!this.config.isInstalled(ext)) {
      throw new Error(`Can't uninstall ${this.type} '${ext}'; it is not installed`);
    }

    try {
      await _support.fs.rimraf(this.config.getInstallPath(ext));
    } finally {
      await this.config.removeExtension(ext);
    }

    (0, _utils.log)(this.isJsonOutput, `Successfully uninstalled ${this.type} '${ext}'`.green);
    return this.config.installedExtensions;
  }

  async update({
    ext,
    unsafe
  }) {
    const shouldUpdateAll = ext === UPDATE_ALL;

    if (!shouldUpdateAll && !this.config.isInstalled(ext)) {
      throw new Error(`The ${this.type} '${ext}' was not installed, so can't be updated`);
    }

    const extsToUpdate = shouldUpdateAll ? Object.keys(this.config.installedExtensions) : [ext];
    const errors = {};
    const updates = {};

    for (const e of extsToUpdate) {
      try {
        await (0, _utils.spinWith)(this.isJsonOutput, `Checking if ${this.type} '${e}' is updatable`, () => {
          if (this.config.installedExtensions[e].installType !== _extensionConfig.INSTALL_TYPE_NPM) {
            throw new NotUpdatableError();
          }
        });
        const update = await (0, _utils.spinWith)(this.isJsonOutput, `Checking if ${this.type} '${e}' needs an update`, async () => {
          const update = await this.checkForExtensionUpdate(e);

          if (!(update.safeUpdate || update.unsafeUpdate)) {
            throw new NoUpdatesAvailableError();
          }

          return update;
        });

        if (!unsafe && !update.safeUpdate) {
          throw new Error(`The ${this.type} '${e}' has a major revision update ` + `(${update.current} => ${update.unsafeUpdate}), which could include ` + `breaking changes. If you want to apply this update, re-run with --unsafe`);
        }

        const updateVer = unsafe && update.unsafeUpdate ? update.unsafeUpdate : update.safeUpdate;
        await (0, _utils.spinWith)(this.isJsonOutput, `Updating driver '${e}' from ${update.current} to ${updateVer}`, async () => await this.updateExtension(e, updateVer));
        updates[e] = {
          from: update.current,
          to: updateVer
        };
      } catch (err) {
        errors[e] = err;
      }
    }

    (0, _utils.log)(this.isJsonOutput, 'Update report:');

    for (const [e, update] of _lodash.default.toPairs(updates)) {
      (0, _utils.log)(this.isJsonOutput, `- ${this.type} ${e} updated: ${update.from} => ${update.to}`.green);
    }

    for (const [e, err] of _lodash.default.toPairs(errors)) {
      if (err instanceof NotUpdatableError) {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' was not installed via npm, so we could not check ` + `for updates`.yellow);
      } else if (err instanceof NoUpdatesAvailableError) {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' had no updates available`.yellow);
      } else {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' failed to update: ${err}`.red);
      }
    }

    return {
      updates,
      errors
    };
  }

  async checkForExtensionUpdate(ext) {
    const {
      version,
      pkgName
    } = this.config.installedExtensions[ext];
    let unsafeUpdate = await this.npm.getLatestVersion(pkgName);
    let safeUpdate = await this.npm.getLatestSafeUpgradeVersion(pkgName, version);

    if (!_support.util.compareVersions(unsafeUpdate, '>', version)) {
      unsafeUpdate = null;
      safeUpdate = null;
    }

    if (unsafeUpdate && unsafeUpdate === safeUpdate) {
      unsafeUpdate = null;
    }

    if (safeUpdate && !_support.util.compareVersions(safeUpdate, '>', version)) {
      safeUpdate = null;
    }

    return {
      current: version,
      safeUpdate,
      unsafeUpdate
    };
  }

  async updateExtension(ext, version) {
    const {
      pkgName
    } = this.config.installedExtensions[ext];
    await _support.fs.rimraf(this.config.getInstallPath(ext));
    const extData = await this.installViaNpm({
      ext,
      pkgName,
      pkgVer: version
    });
    delete extData[`${this.type}Name`];
    await this.config.updateExtension(ext, extData);
  }

  async run({
    ext,
    scriptName
  }) {
    if (!_lodash.default.has(this.config.installedExtensions, ext)) {
      throw new Error(`please install the ${this.type} first`);
    }

    const extConfig = this.config.installedExtensions[ext];

    if (!_lodash.default.has(extConfig, 'scripts')) {
      throw new Error(`The ${this.type} named '${ext}' does not contain the ` + `"scripts" field underneath the "appium" field in its package.json`);
    }

    const extScripts = extConfig.scripts;

    if (!_lodash.default.isPlainObject(extScripts)) {
      throw new Error(`The ${this.type} named '${ext}' "scripts" field must be a plain object`);
    }

    if (!_lodash.default.has(extScripts, scriptName)) {
      throw new Error(`The ${this.type} named '${ext}' does not support the script: '${scriptName}'`);
    }

    const runner = new _teen_process.SubProcess(process.execPath, [extScripts[scriptName]], {
      cwd: this.config.getExtensionRequirePath(ext)
    });
    const output = new _utils.RingBuffer(50);
    runner.on('stream-line', line => {
      output.enqueue(line);
      (0, _utils.log)(this.isJsonOutput, line);
    });
    await runner.start(0);

    try {
      await runner.join();
      (0, _utils.log)(this.isJsonOutput, `${scriptName} successfuly ran`.green);
      return {
        output: output.getBuff()
      };
    } catch (err) {
      (0, _utils.log)(this.isJsonOutput, `Encountered an error when running '${scriptName}': ${err.message}`.red);
      return {
        error: err.message,
        output: output.getBuff()
      };
    }
  }

}

exports.default = ExtensionCommand;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jbGkvZXh0ZW5zaW9uLWNvbW1hbmQuanMiXSwibmFtZXMiOlsiVVBEQVRFX0FMTCIsIk5vdFVwZGF0YWJsZUVycm9yIiwiRXJyb3IiLCJOb1VwZGF0ZXNBdmFpbGFibGVFcnJvciIsIkV4dGVuc2lvbkNvbW1hbmQiLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsImpzb24iLCJ0eXBlIiwiaXNKc29uT3V0cHV0IiwibnBtIiwiTlBNIiwiYXBwaXVtSG9tZSIsImtub3duRXh0ZW5zaW9ucyIsImV4ZWN1dGUiLCJhcmdzIiwiY21kIiwiXyIsImlzRnVuY3Rpb24iLCJwcm90b3R5cGUiLCJleGVjdXRlQ21kIiwiYmluZCIsImxpc3QiLCJzaG93SW5zdGFsbGVkIiwic2hvd1VwZGF0ZXMiLCJsc01zZyIsImluc3RhbGxlZE5hbWVzIiwiT2JqZWN0Iiwia2V5cyIsImluc3RhbGxlZEV4dGVuc2lvbnMiLCJrbm93bk5hbWVzIiwiZXh0cyIsInJlZHVjZSIsImFjYyIsIm5hbWUiLCJpbmNsdWRlcyIsImluc3RhbGxlZCIsInBrZ05hbWUiLCJleHQiLCJkYXRhIiwidG9QYWlycyIsImluc3RhbGxUeXBlIiwiSU5TVEFMTF9UWVBFX05QTSIsInVwZGF0ZXMiLCJjaGVja0ZvckV4dGVuc2lvblVwZGF0ZSIsInVwZGF0ZVZlcnNpb24iLCJzYWZlVXBkYXRlIiwidW5zYWZlVXBkYXRlVmVyc2lvbiIsInVuc2FmZVVwZGF0ZSIsInVwVG9EYXRlIiwiaW5zdGFsbFNwZWMiLCJ2ZXJzaW9uIiwidHlwZVR4dCIsIklOU1RBTExfVFlQRV9HSVQiLCJJTlNUQUxMX1RZUEVfR0lUSFVCIiwieWVsbG93IiwiSU5TVEFMTF9UWVBFX0xPQ0FMIiwibWFnZW50YSIsImluc3RhbGxUeHQiLCJncmVlbiIsImdyZXkiLCJ1cGRhdGVUeHQiLCJ1cFRvRGF0ZVR4dCIsInVuc2FmZVVwZGF0ZVR4dCIsImN5YW4iLCJjb25zb2xlIiwibG9nIiwiaW5zdGFsbCIsInBhY2thZ2VOYW1lIiwiZXh0RGF0YSIsIm1zZyIsInBrZ0pzb25EYXRhIiwibGlua1BhY2thZ2UiLCJnZXRFeHRlbnNpb25GaWVsZHMiLCJpbnN0YWxsUGF0aCIsInNwbGl0IiwibGVuZ3RoIiwiaW5zdGFsbFZpYU5wbSIsInJlcGxhY2UiLCJwa2dWZXIiLCJzcGxpdHMiLCJKU09OIiwic3RyaW5naWZ5IiwiZXh0TmFtZSIsImlzSW5zdGFsbGVkIiwiYWRkRXh0ZW5zaW9uIiwiZ2V0UG9zdEluc3RhbGxUZXh0IiwibnBtU3BlYyIsInNwZWNNc2ciLCJpbnN0YWxsUGFja2FnZSIsInBrZ0RpciIsInBhdGgiLCJyZXNvbHZlIiwiZXJyIiwibWVzc2FnZSIsImFwcGl1bSIsInZhbGlkYXRlRXh0ZW5zaW9uRmllbGRzIiwidW5pbnN0YWxsIiwiZnMiLCJyaW1yYWYiLCJnZXRJbnN0YWxsUGF0aCIsInJlbW92ZUV4dGVuc2lvbiIsInVwZGF0ZSIsInVuc2FmZSIsInNob3VsZFVwZGF0ZUFsbCIsImV4dHNUb1VwZGF0ZSIsImVycm9ycyIsImUiLCJjdXJyZW50IiwidXBkYXRlVmVyIiwidXBkYXRlRXh0ZW5zaW9uIiwiZnJvbSIsInRvIiwicmVkIiwiZ2V0TGF0ZXN0VmVyc2lvbiIsImdldExhdGVzdFNhZmVVcGdyYWRlVmVyc2lvbiIsInV0aWwiLCJjb21wYXJlVmVyc2lvbnMiLCJydW4iLCJzY3JpcHROYW1lIiwiaGFzIiwiZXh0Q29uZmlnIiwiZXh0U2NyaXB0cyIsInNjcmlwdHMiLCJpc1BsYWluT2JqZWN0IiwicnVubmVyIiwiU3ViUHJvY2VzcyIsInByb2Nlc3MiLCJleGVjUGF0aCIsImN3ZCIsImdldEV4dGVuc2lvblJlcXVpcmVQYXRoIiwib3V0cHV0IiwiUmluZ0J1ZmZlciIsIm9uIiwibGluZSIsImVucXVldWUiLCJzdGFydCIsImpvaW4iLCJnZXRCdWZmIiwiZXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsVUFBVSxHQUFH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T0FBUDtBQUFULE9BQVA7QUFDRCxLQUpELENBSUUsT0FBTzdDLEdBQVAsRUFBWTtBQUNaLHNCQUFJLEtBQUtwRixZQUFULEVBQXdCLHNDQUFxQzhHLFVBQVcsTUFBSzFCLEdBQUcsQ0FBQ0MsT0FBUSxFQUFsRSxDQUFvRW1CLEdBQTNGO0FBQ0EsYUFBTztBQUFDMEIsUUFBQUEsS0FBSyxFQUFFOUMsR0FBRyxDQUFDQyxPQUFaO0FBQXFCcUMsUUFBQUEsTUFBTSxFQUFFQSxNQUFNLENBQUNPLE9BQVA7QUFBN0IsT0FBUDtBQUNEO0FBQ0Y7O0FBdmhCbUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgTlBNIGZyb20gJy4vbnBtJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZnMsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgbG9nLCBzcGluV2l0aCwgUmluZ0J1ZmZlciB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgU3ViUHJvY2Vzc30gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IElOU1RBTExfVFlQRV9OUE0sIElOU1RBTExfVFlQRV9HSVQsIElOU1RBTExfVFlQRV9HSVRIVUIsXG4gICAgICAgICBJTlNUQUxMX1RZUEVfTE9DQUwgfSBmcm9tICcuLi9leHRlbnNpb24tY29uZmlnJztcblxuY29uc3QgVVBEQVRFX0FMTCA9ICdpbnN0YWxsZWQnO1xuXG5jbGFzcyBOb3RVcGRhdGFibGVFcnJvciBleHRlbmRzIEVycm9yIHt9XG5jbGFzcyBOb1VwZGF0ZXNBdmFpbGFibGVFcnJvciBleHRlbmRzIEVycm9yIHt9XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV4dGVuc2lvbkNvbW1hbmQge1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBFeHRlbnNpb25Db21tYW5kQ29uc3RydWN0b3JcbiAgICogQHByb3BlcnR5IHtPYmplY3R9IGNvbmZpZyAtIHRoZSBEcml2ZXJDb25maWcgb3IgUGx1Z2luQ29uZmlnIG9iamVjdCB1c2VkIGZvciB0aGlzIGNvbW1hbmRcbiAgICogQHByb3BlcnR5IHtib29sZWFufSBqc29uIC0gd2hldGhlciB0aGUgb3V0cHV0IG9mIHRoaXMgY29tbWFuZCBzaG91bGQgYmUgSlNPTiBvciB0ZXh0XG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIC0gRFJJVkVSX1RZUEUgb3IgUExVR0lOX1RZUEVcbiAgICovXG5cbiAgLyoqXG4gICAqIEJ1aWxkIGFuIEV4dGVuc2lvbkNvbW1hbmRcbiAgICpcbiAgICogQHBhcmFtIHtFeHRlbnNpb25Db21tYW5kQ29uc3RydWN0b3J9IG9wdHNcbiAgICogQHJldHVybiB7RXh0ZW5zaW9uQ29tbWFuZH1cbiAgICovXG4gIGNvbnN0cnVjdG9yICh7Y29uZmlnLCBqc29uLCB0eXBlfSkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgdGhpcy5pc0pzb25PdXRwdXQgPSBqc29uO1xuICAgIHRoaXMubnBtID0gbmV3IE5QTSh0aGlzLmNvbmZpZy5hcHBpdW1Ib21lKTtcbiAgICB0aGlzLmtub3duRXh0ZW5zaW9ucyA9IHt9OyAvLyB0aGlzIG5lZWRzIHRvIGJlIG92ZXJyaWRkZW4gaW4gZmluYWwgY2xhc3NcbiAgfVxuXG4gIC8qKlxuICAgKiBUYWtlIGEgQ0xJIHBhcnNlIGFuZCBydW4gYW4gZXh0ZW5zaW9uIGNvbW1hbmQgYmFzZWQgb24gaXRzIHR5cGVcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGFyZ3MgLSBhIGtleS92YWx1ZSBvYmplY3Qgd2l0aCBDTEkgZmxhZ3MgYW5kIHZhbHVlc1xuICAgKiBAcmV0dXJuIHtvYmplY3R9IHRoZSByZXN1bHQgb2YgdGhlIHNwZWNpZmljIGNvbW1hbmQgd2hpY2ggaXMgZXhlY3V0ZWRcbiAgICovXG4gIGFzeW5jIGV4ZWN1dGUgKGFyZ3MpIHtcbiAgICBjb25zdCBjbWQgPSBhcmdzW2Ake3RoaXMudHlwZX1Db21tYW5kYF07XG4gICAgaWYgKCFfLmlzRnVuY3Rpb24oRXh0ZW5zaW9uQ29tbWFuZC5wcm90b3R5cGVbY21kXSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGhhbmRsZSAke3RoaXMudHlwZX0gY29tbWFuZCAke2NtZH1gKTtcbiAgICB9XG4gICAgY29uc3QgZXhlY3V0ZUNtZCA9IHRoaXNbY21kXS5iaW5kKHRoaXMpO1xuICAgIHJldHVybiBhd2FpdCBleGVjdXRlQ21kKGFyZ3MpO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IExpc3RBcmdzXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gc2hvd0luc3RhbGxlZCAtIHdoZXRoZXIgc2hvdWxkIHNob3cgb25seSBpbnN0YWxsZWQgZXh0ZW5zaW9uc1xuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IHNob3dVcGRhdGVzIC0gd2hldGhlciBzaG91bGQgc2hvdyBhdmFpbGFibGUgdXBkYXRlc1xuICAgKi9cblxuICAvKipcbiAgICogTGlzdCBleHRlbnNpb25zXG4gICAqXG4gICAqIEBwYXJhbSB7TGlzdEFyZ3N9IGFyZ3NcbiAgICogQHJldHVybiB7b2JqZWN0fSBtYXAgb2YgZXh0ZW5zaW9uIG5hbWVzIHRvIGV4dGVuc2lvbiBkYXRhXG4gICAqL1xuICBhc3luYyBsaXN0ICh7c2hvd0luc3RhbGxlZCwgc2hvd1VwZGF0ZXN9KSB7XG4gICAgY29uc3QgbHNNc2cgPSBgTGlzdGluZyAke3Nob3dJbnN0YWxsZWQgPyAnaW5zdGFsbGVkJyA6ICdhdmFpbGFibGUnfSAke3RoaXMudHlwZX1zYDtcbiAgICBjb25zdCBpbnN0YWxsZWROYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnMpO1xuICAgIGNvbnN0IGtub3duTmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLmtub3duRXh0ZW5zaW9ucyk7XG4gICAgY29uc3QgZXh0cyA9IFsuLi5pbnN0YWxsZWROYW1lcywgLi4ua25vd25OYW1lc10ucmVkdWNlKChhY2MsIG5hbWUpID0+IHtcbiAgICAgIGlmICghYWNjW25hbWVdKSB7XG4gICAgICAgIGlmIChpbnN0YWxsZWROYW1lcy5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICAgIGFjY1tuYW1lXSA9IHsuLi50aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW25hbWVdLCBpbnN0YWxsZWQ6IHRydWV9O1xuICAgICAgICB9IGVsc2UgaWYgKCFzaG93SW5zdGFsbGVkKSB7XG4gICAgICAgICAgYWNjW25hbWVdID0ge3BrZ05hbWU6IHRoaXMua25vd25FeHRlbnNpb25zW25hbWVdLCBpbnN0YWxsZWQ6IGZhbHNlfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG5cbiAgICAvLyBpZiB3ZSB3YW50IHRvIHNob3cgd2hldGhlciB1cGRhdGVzIGFyZSBhdmFpbGFibGUsIHB1dCB0aGF0IGJlaGluZCBhIHNwaW5uZXJcbiAgICBhd2FpdCBzcGluV2l0aCh0aGlzLmlzSnNvbk91dHB1dCwgbHNNc2csIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghc2hvd1VwZGF0ZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBbZXh0LCBkYXRhXSBvZiBfLnRvUGFpcnMoZXh0cykpIHtcbiAgICAgICAgY29uc3Qge2luc3RhbGxlZCwgaW5zdGFsbFR5cGV9ID0gZGF0YTtcbiAgICAgICAgaWYgKCFpbnN0YWxsZWQgfHwgaW5zdGFsbFR5cGUgIT09IElOU1RBTExfVFlQRV9OUE0pIHtcbiAgICAgICAgICAvLyBkb24ndCBuZWVkIHRvIGNoZWNrIGZvciB1cGRhdGVzIG9uIGV4dHMgdGhhdCBhcmVuJ3QgaW5zdGFsbGVkXG4gICAgICAgICAgLy8gYWxzbyBkb24ndCBuZWVkIHRvIGNoZWNrIGZvciB1cGRhdGVzIG9uIG5vbi1ucG0gZXh0c1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVwZGF0ZXMgPSBhd2FpdCB0aGlzLmNoZWNrRm9yRXh0ZW5zaW9uVXBkYXRlKGV4dCk7XG4gICAgICAgIGRhdGEudXBkYXRlVmVyc2lvbiA9IHVwZGF0ZXMuc2FmZVVwZGF0ZTtcbiAgICAgICAgZGF0YS51bnNhZmVVcGRhdGVWZXJzaW9uID0gdXBkYXRlcy51bnNhZmVVcGRhdGU7XG4gICAgICAgIGRhdGEudXBUb0RhdGUgPSB1cGRhdGVzLnNhZmVVcGRhdGUgPT09IG51bGwgJiYgdXBkYXRlcy51bnNhZmVVcGRhdGUgPT09IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBpZiB3ZSdyZSBqdXN0IGdldHRpbmcgdGhlIGRhdGEsIHNob3J0IGNpcmN1aXQgcmV0dXJuIGhlcmUgc2luY2Ugd2UgZG9uJ3QgbmVlZCB0byBkbyBhbnlcbiAgICAvLyBmb3JtYXR0aW5nIGxvZ2ljXG4gICAgaWYgKHRoaXMuaXNKc29uT3V0cHV0KSB7XG4gICAgICByZXR1cm4gZXh0cztcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IFtcbiAgICAgIG5hbWUsXG4gICAgICB7aW5zdGFsbFR5cGUsIGluc3RhbGxTcGVjLCBpbnN0YWxsZWQsIHVwZGF0ZVZlcnNpb24sIHVuc2FmZVVwZGF0ZVZlcnNpb24sIHZlcnNpb24sIHVwVG9EYXRlfVxuICAgIF0gb2YgXy50b1BhaXJzKGV4dHMpKSB7XG4gICAgICBsZXQgdHlwZVR4dDtcbiAgICAgIHN3aXRjaCAoaW5zdGFsbFR5cGUpIHtcbiAgICAgICAgY2FzZSBJTlNUQUxMX1RZUEVfR0lUOlxuICAgICAgICBjYXNlIElOU1RBTExfVFlQRV9HSVRIVUI6XG4gICAgICAgICAgdHlwZVR4dCA9IGAoY2xvbmVkIGZyb20gJHtpbnN0YWxsU3BlY30pYC55ZWxsb3c7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgSU5TVEFMTF9UWVBFX0xPQ0FMOlxuICAgICAgICAgIHR5cGVUeHQgPSBgKGxpbmtlZCBmcm9tICR7aW5zdGFsbFNwZWN9KWAubWFnZW50YTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0eXBlVHh0ID0gJyhOUE0pJztcbiAgICAgIH1cbiAgICAgIGNvbnN0IGluc3RhbGxUeHQgPSBpbnN0YWxsZWQgP1xuICAgICAgICBgQCR7dmVyc2lvbi55ZWxsb3d9ICR7KCdbaW5zdGFsbGVkICcgKyB0eXBlVHh0ICsgJ10nKS5ncmVlbn1gIDpcbiAgICAgICAgJyBbbm90IGluc3RhbGxlZF0nLmdyZXk7XG4gICAgICBjb25zdCB1cGRhdGVUeHQgPSBzaG93VXBkYXRlcyAmJiB1cGRhdGVWZXJzaW9uID9cbiAgICAgICAgYCBbJHt1cGRhdGVWZXJzaW9ufSBhdmFpbGFibGVdYC5tYWdlbnRhIDpcbiAgICAgICAgJyc7XG4gICAgICBjb25zdCB1cFRvRGF0ZVR4dCA9IHNob3dVcGRhdGVzICYmIHVwVG9EYXRlID9cbiAgICAgICAgYCBbVXAgdG8gZGF0ZV1gLmdyZWVuIDpcbiAgICAgICAgJyc7XG4gICAgICBjb25zdCB1bnNhZmVVcGRhdGVUeHQgPSBzaG93VXBkYXRlcyAmJiB1bnNhZmVVcGRhdGVWZXJzaW9uID9cbiAgICAgICAgYCBbJHt1bnNhZmVVcGRhdGVWZXJzaW9ufSBhdmFpbGFibGUgKHBvdGVudGlhbGx5IHVuc2FmZSldYC5jeWFuIDpcbiAgICAgICAgJyc7XG5cbiAgICAgIGNvbnNvbGUubG9nKGAtICR7bmFtZS55ZWxsb3d9JHtpbnN0YWxsVHh0fSR7dXBkYXRlVHh0fSR7dXBUb0RhdGVUeHR9JHt1bnNhZmVVcGRhdGVUeHR9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGV4dHM7XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbEFyZ3NcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGV4dCAtIHRoZSBuYW1lIG9yIHNwZWMgb2YgYW4gZXh0ZW5zaW9uIHRvIGluc3RhbGxcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGluc3RhbGxUeXBlIC0gaG93IHRvIGluc3RhbGwgdGhpcyBleHRlbnNpb24uIE9uZSBvZiB0aGUgSU5TVEFMTF9UWVBFU1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3BhY2thZ2VOYW1lXSAtIGZvciBnaXQvZ2l0aHViIGluc3RhbGxzLCB0aGUgZXh0ZW5zaW9uIG5vZGUgcGFja2FnZSBuYW1lXG4gICAqL1xuXG4gIC8qKlxuICAgKiBJbnN0YWxsIGFuIGV4dGVuc2lvblxuICAgKlxuICAgKiBAcGFyYW0ge0luc3RhbGxBcmdzfSBhcmdzXG4gICAqIEByZXR1cm4ge29iamVjdH0gbWFwIG9mIGFsbCBpbnN0YWxsZWQgZXh0ZW5zaW9uIG5hbWVzIHRvIGV4dGVuc2lvbiBkYXRhXG4gICAqL1xuICBhc3luYyBpbnN0YWxsICh7ZXh0LCBpbnN0YWxsVHlwZSwgcGFja2FnZU5hbWV9KSB7XG4gICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgQXR0ZW1wdGluZyB0byBmaW5kIGFuZCBpbnN0YWxsICR7dGhpcy50eXBlfSAnJHtleHR9J2ApO1xuXG4gICAgbGV0IGV4dERhdGE7XG4gICAgbGV0IGluc3RhbGxTcGVjID0gZXh0O1xuXG4gICAgaWYgKHBhY2thZ2VOYW1lICYmIFtJTlNUQUxMX1RZUEVfTE9DQUwsIElOU1RBTExfVFlQRV9OUE1dLmluY2x1ZGVzKGluc3RhbGxUeXBlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBXaGVuIHVzaW5nIC0tc291cmNlPSR7aW5zdGFsbFR5cGV9LCBjYW5ub3QgYWxzbyB1c2UgLS1wYWNrYWdlYCk7XG4gICAgfVxuXG4gICAgaWYgKCFwYWNrYWdlTmFtZSAmJiBbSU5TVEFMTF9UWVBFX0dJVCwgSU5TVEFMTF9UWVBFX0dJVEhVQl0uaW5jbHVkZXMoaW5zdGFsbFR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFdoZW4gdXNpbmcgLS1zb3VyY2U9JHtpbnN0YWxsVHlwZX0sIG11c3QgYWxzbyB1c2UgLS1wYWNrYWdlYCk7XG4gICAgfVxuXG4gICAgaWYgKGluc3RhbGxUeXBlID09PSBJTlNUQUxMX1RZUEVfTE9DQUwpIHtcbiAgICAgIGNvbnN0IG1zZyA9IGBMaW5raW5nICR7dGhpcy50eXBlfSBmcm9tIGxvY2FsIHBhdGhgO1xuICAgICAgY29uc3QgcGtnSnNvbkRhdGEgPSBhd2FpdCBzcGluV2l0aCh0aGlzLmlzSnNvbk91dHB1dCwgbXNnLCBhc3luYyAoKSA9PiAoXG4gICAgICAgIGF3YWl0IHRoaXMubnBtLmxpbmtQYWNrYWdlKGluc3RhbGxTcGVjKSlcbiAgICAgICk7XG4gICAgICBleHREYXRhID0gdGhpcy5nZXRFeHRlbnNpb25GaWVsZHMocGtnSnNvbkRhdGEpO1xuICAgICAgZXh0RGF0YS5pbnN0YWxsUGF0aCA9IGV4dERhdGEucGtnTmFtZTtcbiAgICB9IGVsc2UgaWYgKGluc3RhbGxUeXBlID09PSBJTlNUQUxMX1RZUEVfR0lUSFVCKSB7XG4gICAgICBpZiAoaW5zdGFsbFNwZWMuc3BsaXQoJy8nKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBHaXRodWIgJHt0aGlzLnR5cGV9IHNwZWMgJHtpbnN0YWxsU3BlY30gYXBwZWFyZWQgdG8gYmUgaW52YWxpZDsgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAnaXQgc2hvdWxkIGJlIG9mIHRoZSBmb3JtIDxvcmc+LzxyZXBvPicpO1xuICAgICAgfVxuICAgICAgZXh0RGF0YSA9IGF3YWl0IHRoaXMuaW5zdGFsbFZpYU5wbSh7ZXh0OiBpbnN0YWxsU3BlYywgcGtnTmFtZTogcGFja2FnZU5hbWV9KTtcbiAgICB9IGVsc2UgaWYgKGluc3RhbGxUeXBlID09PSBJTlNUQUxMX1RZUEVfR0lUKSB7XG4gICAgICAvLyBnaXQgdXJscyBjYW4gaGF2ZSAnLmdpdCcgYXQgdGhlIGVuZCwgYnV0IHRoaXMgaXMgbm90IG5lY2Vzc2FyeSBhbmQgd291bGQgY29tcGxpY2F0ZSB0aGVcbiAgICAgIC8vIHdheSB3ZSBkb3dubG9hZCBhbmQgbmFtZSBkaXJlY3Rvcmllcywgc28gd2UgY2FuIGp1c3QgcmVtb3ZlIGl0XG4gICAgICBpbnN0YWxsU3BlYyA9IGluc3RhbGxTcGVjLnJlcGxhY2UoL1xcLmdpdCQvLCAnJyk7XG4gICAgICBleHREYXRhID0gYXdhaXQgdGhpcy5pbnN0YWxsVmlhTnBtKHtleHQ6IGluc3RhbGxTcGVjLCBwa2dOYW1lOiBwYWNrYWdlTmFtZX0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBhdCB0aGlzIHBvaW50IHdlIGhhdmUgZWl0aGVyIGFuIG5wbSBwYWNrYWdlIG9yIGFuIGFwcGl1bSB2ZXJpZmllZCBleHRlbnNpb25cbiAgICAgIC8vIG5hbWUuIGJvdGggb2Ygd2hpY2ggd2lsbCBiZSBpbnN0YWxsZWQgdmlhIG5wbS5cbiAgICAgIC8vIGV4dGVuc2lvbnMgaW5zdGFsbGVkIHZpYSBucG0gY2FuIGluY2x1ZGUgdmVyc2lvbnMgb3IgdGFncyBhZnRlciB0aGUgJ0AnXG4gICAgICAvLyBzaWduLCBzbyBjaGVjayBmb3IgdGhhdC4gV2UgYWxzbyBuZWVkIHRvIGJlIGNhcmVmdWwgdGhhdCBwYWNrYWdlIG5hbWVzIHRoZW1zZWx2ZXMgY2FuXG4gICAgICAvLyBjb250YWluIHRoZSAnQCcgc3ltYm9sLCBhcyBpbiBgbnBtIGluc3RhbGwgQGFwcGl1bS9mYWtlLWRyaXZlckAxLjIuMGBcbiAgICAgIGxldCBuYW1lLCBwa2dWZXI7XG4gICAgICBjb25zdCBzcGxpdHMgPSBpbnN0YWxsU3BlYy5zcGxpdCgnQCcpO1xuICAgICAgaWYgKGluc3RhbGxTcGVjWzBdID09PSAnQCcpIHtcbiAgICAgICAgLy8gdGhpcyBpcyB0aGUgY2FzZSB3aGVyZSB3ZSBoYXZlIGFuIG5wbSBvcmcgaW5jbHVkZWQgaW4gdGhlIHBhY2thZ2UgbmFtZVxuICAgICAgICBbbmFtZSwgcGtnVmVyXSA9IFtgQCR7c3BsaXRzWzFdfWAsIHNwbGl0c1syXV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdpdGhvdXQgYW4gbnBtIG9yZ1xuICAgICAgICBbbmFtZSwgcGtnVmVyXSA9IHNwbGl0cztcbiAgICAgIH1cbiAgICAgIGxldCBwa2dOYW1lO1xuXG4gICAgICBpZiAoaW5zdGFsbFR5cGUgPT09IElOU1RBTExfVFlQRV9OUE0pIHtcbiAgICAgICAgLy8gaWYgd2UncmUgaW5zdGFsbGluZyBhIG5hbWVkIHBhY2thZ2UgZnJvbSBucG0sIHdlIGRvbid0IG5lZWQgdG8gY2hlY2tcbiAgICAgICAgLy8gYWdhaW5zdCB0aGUgYXBwaXVtIGV4dGVuc2lvbiBsaXN0OyBqdXN0IHVzZSB0aGUgaW5zdGFsbFNwZWMgYXMgaXNcbiAgICAgICAgcGtnTmFtZSA9IG5hbWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBpZiB3ZSdyZSBpbnN0YWxsaW5nIGEgbmFtZWQgYXBwaXVtIGRyaXZlciAobGlrZSAneGN1aXRlc3QnKSB3ZSBuZWVkIHRvXG4gICAgICAgIC8vIGRlcmVmZXJlbmNlIHRoZSBhY3R1YWwgbnBtIHBhY2thZ2UgKCdhcHBpdXBtLXhjdWl0ZXN0LWRyaXZlcicpLCBzb1xuICAgICAgICAvLyBjaGVjayBpdCBleGlzdHMgYW5kIGdldCB0aGUgY29ycmVjdCBwYWNrYWdlXG4gICAgICAgIGNvbnN0IGtub3duTmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLmtub3duRXh0ZW5zaW9ucyk7XG4gICAgICAgIGlmICghXy5pbmNsdWRlcyhrbm93bk5hbWVzLCBuYW1lKSkge1xuICAgICAgICAgIGNvbnN0IG1zZyA9IGBDb3VsZCBub3QgcmVzb2x2ZSAke3RoaXMudHlwZX07IGFyZSB5b3Ugc3VyZSBpdCdzIGluIHRoZSBsaXN0IGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBvZiBzdXBwb3J0ZWQgJHt0aGlzLnR5cGV9cz8gJHtKU09OLnN0cmluZ2lmeShrbm93bk5hbWVzKX1gO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICAgICAgICB9XG4gICAgICAgIHBrZ05hbWUgPSB0aGlzLmtub3duRXh0ZW5zaW9uc1tuYW1lXTtcbiAgICAgICAgLy8gZ2l2ZW4gdGhhdCB3ZSdsbCB1c2UgdGhlIGluc3RhbGwgdHlwZSBpbiB0aGUgZHJpdmVyIGpzb24sIHN0b3JlIGl0IGFzXG4gICAgICAgIC8vICducG0nIG5vd1xuICAgICAgICBpbnN0YWxsVHlwZSA9IElOU1RBTExfVFlQRV9OUE07XG4gICAgICB9XG5cbiAgICAgIGV4dERhdGEgPSBhd2FpdCB0aGlzLmluc3RhbGxWaWFOcG0oe2V4dCwgcGtnTmFtZSwgcGtnVmVyfSk7XG4gICAgfVxuXG4gICAgY29uc3QgZXh0TmFtZSA9IGV4dERhdGFbYCR7dGhpcy50eXBlfU5hbWVgXTtcbiAgICBkZWxldGUgZXh0RGF0YVtgJHt0aGlzLnR5cGV9TmFtZWBdO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLmlzSW5zdGFsbGVkKGV4dE5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEEgJHt0aGlzLnR5cGV9IG5hbWVkICcke2V4dE5hbWV9JyBpcyBhbHJlYWR5IGluc3RhbGxlZC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYERpZCB5b3UgbWVhbiB0byB1cGRhdGU/ICdhcHBpdW0gJHt0aGlzLnR5cGV9IHVwZGF0ZScuIFNlZSBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgaW5zdGFsbGVkICR7dGhpcy50eXBlfXMgd2l0aCAnYXBwaXVtICR7dGhpcy50eXBlfSBsaXN0IC0taW5zdGFsbGVkJy5gKTtcbiAgICB9XG5cbiAgICBleHREYXRhLmluc3RhbGxUeXBlID0gaW5zdGFsbFR5cGU7XG4gICAgZXh0RGF0YS5pbnN0YWxsU3BlYyA9IGluc3RhbGxTcGVjO1xuICAgIGF3YWl0IHRoaXMuY29uZmlnLmFkZEV4dGVuc2lvbihleHROYW1lLCBleHREYXRhKTtcblxuICAgIC8vIGxvZyBpbmZvIGZvciB0aGUgdXNlclxuICAgIGxvZyh0aGlzLmlzSnNvbk91dHB1dCwgdGhpcy5nZXRQb3N0SW5zdGFsbFRleHQoe2V4dE5hbWUsIGV4dERhdGF9KSk7XG5cbiAgICByZXR1cm4gdGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsVmlhTnBtQXJnc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gZXh0IC0gdGhlIG5hbWUgb3Igc3BlYyBvZiBhbiBleHRlbnNpb24gdG8gaW5zdGFsbFxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGtnTmFtZSAtIHRoZSBOUE0gcGFja2FnZSBuYW1lIG9mIHRoZSBleHRlbnNpb25cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtwa2dWZXJdIC0gdGhlIHNwZWNpZmljIHZlcnNpb24gb2YgdGhlIE5QTSBwYWNrYWdlXG4gICAqL1xuXG4gIC8qKlxuICAgKiBJbnN0YWxsIGFuIGV4dGVuc2lvbiB2aWEgTlBNXG4gICAqXG4gICAqIEBwYXJhbSB7SW5zdGFsbFZpYU5wbUFyZ3N9IGFyZ3NcbiAgICovXG4gIGFzeW5jIGluc3RhbGxWaWFOcG0gKHtleHQsIHBrZ05hbWUsIHBrZ1Zlcn0pIHtcbiAgICBjb25zdCBucG1TcGVjID0gYCR7cGtnTmFtZX0ke3BrZ1ZlciA/ICdAJyArIHBrZ1ZlciA6ICcnfWA7XG4gICAgY29uc3Qgc3BlY01zZyA9IG5wbVNwZWMgPT09IGV4dCA/ICcnIDogYCB1c2luZyBOUE0gaW5zdGFsbCBzcGVjICcke25wbVNwZWN9J2A7XG4gICAgY29uc3QgbXNnID0gYEluc3RhbGxpbmcgJyR7ZXh0fScke3NwZWNNc2d9YDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGtnSnNvbkRhdGEgPSBhd2FpdCBzcGluV2l0aCh0aGlzLmlzSnNvbk91dHB1dCwgbXNnLCBhc3luYyAoKSA9PiAoXG4gICAgICAgIGF3YWl0IHRoaXMubnBtLmluc3RhbGxQYWNrYWdlKHtcbiAgICAgICAgICBwa2dEaXI6IHBhdGgucmVzb2x2ZSh0aGlzLmNvbmZpZy5hcHBpdW1Ib21lLCBwa2dOYW1lKSxcbiAgICAgICAgICBwa2dOYW1lLFxuICAgICAgICAgIHBrZ1ZlclxuICAgICAgICB9KVxuICAgICAgKSk7XG4gICAgICBjb25zdCBleHREYXRhID0gdGhpcy5nZXRFeHRlbnNpb25GaWVsZHMocGtnSnNvbkRhdGEpO1xuICAgICAgZXh0RGF0YS5pbnN0YWxsUGF0aCA9IHBrZ05hbWU7XG4gICAgICByZXR1cm4gZXh0RGF0YTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRW5jb3VudGVyZWQgYW4gZXJyb3Igd2hlbiBpbnN0YWxsaW5nIHBhY2thZ2U6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IEV4dGVuc2lvbkFyZ3NcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGV4dE5hbWUgLSB0aGUgbmFtZSBvZiBhbiBleHRlbnNpb25cbiAgICogQHByb3BlcnR5IHtvYmplY3R9IGV4dERhdGEgLSB0aGUgZGF0YSBmb3IgYW4gaW5zdGFsbGVkIGV4dGVuc2lvblxuICAgKi9cblxuICAvKipcbiAgICogR2V0IHRoZSB0ZXh0IHdoaWNoIHNob3VsZCBiZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgYWZ0ZXIgYW4gZXh0ZW5zaW9uIGhhcyBiZWVuIGluc3RhbGxlZC4gVGhpc1xuICAgKiBpcyBkZXNpZ25lZCB0byBiZSBvdmVycmlkZGVuIGJ5IGRyaXZlcnMvcGx1Z2lucyB3aXRoIHRoZWlyIG93biBwYXJ0aWN1bGFyIHRleHQuXG4gICAqXG4gICAqIEBwYXJhbSB7RXh0ZW5zaW9uQXJnc30gYXJnc1xuICAgKi9cbiAgZ2V0UG9zdEluc3RhbGxUZXh0ICgvKntleHROYW1lLCBleHREYXRhfSovKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IGJlIGltcGxlbWVudGVkIGluIGZpbmFsIGNsYXNzJyk7XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhbiBOUE0gbW9kdWxlJ3MgcGFja2FnZS5qc29uIGFuZCBleHRyYWN0IEFwcGl1bSBkcml2ZXIgaW5mb3JtYXRpb24gZnJvbSBhIHNwZWNpYWxcbiAgICogJ2FwcGl1bScgZmllbGQgaW4gdGhlIEpTT04gZGF0YS4gV2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIHRvIGUuZy4gZGV0ZXJtaW5lIHdoaWNoIGNsYXNzIHRvXG4gICAqIGxvYWQgYXMgdGhlIG1haW4gZHJpdmVyIGNsYXNzLCBvciB0byBiZSBhYmxlIHRvIGRldGVjdCBpbmNvbXBhdGliaWxpdGllcyBiZXR3ZWVuIGRyaXZlciBhbmRcbiAgICogYXBwaXVtIHZlcnNpb25zLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gcGtnSnNvbkRhdGEgLSB0aGUgcGFja2FnZS5qc29uIGRhdGEgZm9yIGEgZHJpdmVyIG1vZHVsZSwgYXMgaWYgaXQgaGFkIGJlZW5cbiAgICogc3RyYWlnaHRmb3J3YXJkbHkgJ3JlcXVpcmUnZFxuICAgKi9cbiAgZ2V0RXh0ZW5zaW9uRmllbGRzIChwa2dKc29uRGF0YSkge1xuICAgIGlmICghcGtnSnNvbkRhdGEuYXBwaXVtKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEluc3RhbGxlZCBkcml2ZXIgZGlkIG5vdCBoYXZlIGFuICdhcHBpdW0nIHNlY3Rpb24gaW4gaXRzIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBwYWNrYWdlLmpzb24gZmlsZSBhcyBleHBlY3RlZGApO1xuICAgIH1cbiAgICBjb25zdCB7YXBwaXVtLCBuYW1lLCB2ZXJzaW9ufSA9IHBrZ0pzb25EYXRhO1xuICAgIHRoaXMudmFsaWRhdGVFeHRlbnNpb25GaWVsZHMoYXBwaXVtKTtcblxuICAgIHJldHVybiB7Li4uYXBwaXVtLCBwa2dOYW1lOiBuYW1lLCB2ZXJzaW9ufTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3IgYW55IHBhY2thZ2UuanNvbiBmaWVsZHMgd2hpY2ggYSBwYXJ0aWN1bGFyIHR5cGUgb2YgZXh0ZW5zaW9uIHJlcXVpcmVzLCB2YWxpZGF0ZSB0aGVcbiAgICogcHJlc2VuY2UgYW5kIGZvcm0gb2YgdGhvc2UgZmllbGRzIG9uIHRoZSBwYWNrYWdlLmpzb24gZGF0YSwgdGhyb3dpbmcgYW4gZXJyb3IgaWYgYW55dGhpbmcgaXNcbiAgICogYW1pc3MuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBhcHBpdW1Qa2dEYXRhIC0gdGhlIGRhdGEgaW4gdGhlIFwiYXBwaXVtXCIgZmllbGQgb2YgcGFja2FnZS5qc29uIGZvciBhblxuICAgKiBleHRlbnNpb25cbiAgICovXG4gIHZhbGlkYXRlRXh0ZW5zaW9uRmllbGRzICgvKmFwcGl1bVBrZ0RhdGEqLykge1xuICAgIHRocm93IG5ldyBFcnJvcignTXVzdCBiZSBpbXBsZW1lbnRlZCBpbiBmaW5hbCBjbGFzcycpO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFVuaW5zdGFsbEFyZ3NcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGV4dCAtIHRoZSBuYW1lIG9yIHNwZWMgb2YgYW4gZXh0ZW5zaW9uIHRvIHVuaW5zdGFsbFxuICAgKi9cblxuICAvKipcbiAgICogVW5pbnN0YWxsIGFuIGV4dGVuc2lvblxuICAgKlxuICAgKiBAcGFyYW0ge1VuaW5zdGFsbEFyZ3N9IGFyZ3NcbiAgICogQHJldHVybiB7b2JqZWN0fSBtYXAgb2YgYWxsIGluc3RhbGxlZCBleHRlbnNpb24gbmFtZXMgdG8gZXh0ZW5zaW9uIGRhdGFcbiAgICovXG4gIGFzeW5jIHVuaW5zdGFsbCAoe2V4dH0pIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmlzSW5zdGFsbGVkKGV4dCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgdW5pbnN0YWxsICR7dGhpcy50eXBlfSAnJHtleHR9JzsgaXQgaXMgbm90IGluc3RhbGxlZGApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMuY29uZmlnLmdldEluc3RhbGxQYXRoKGV4dCkpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbmZpZy5yZW1vdmVFeHRlbnNpb24oZXh0KTtcbiAgICB9XG4gICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgU3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkICR7dGhpcy50eXBlfSAnJHtleHR9J2AuZ3JlZW4pO1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IEV4dGVuc2lvblVwZGF0ZU9wdHNcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGV4dCAtIHRoZSBuYW1lIG9mIHRoZSBleHRlbnNpb24gdG8gdXBkYXRlXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdW5zYWZlIC0gaWYgdHJ1ZSwgd2lsbCBwZXJmb3JtIHVuc2FmZSB1cGRhdGVzIHBhc3QgbWFqb3IgcmV2aXNpb25cbiAgICogYm91bmRhcmllc1xuICAgKi9cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gVXBkYXRlUmVwb3J0XG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBmcm9tIC0gdmVyc2lvbiB1cGRhdGVkIGZyb21cbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHRvIC0gdmVyc2lvbiB1cGRhdGVkIHRvXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBFeHRlbnNpb25VcGRhdGVSZXN1bHRcbiAgICogQHByb3BlcnR5IHtPYmplY3R9IGVycm9ycyAtIG1hcCBvZiBleHQgbmFtZXMgdG8gZXJyb3Igb2JqZWN0c1xuICAgKiBAcHJvcGVydHkge09iamVjdH0gdXBkYXRlcyAtIG1hcCBvZiBleHQgbmFtZXMgdG8ge0BsaW5rIFVwZGF0ZVJlcG9ydH1zXG4gICAqL1xuXG4gIC8qKlxuICAgKiBBdHRlbXB0IHRvIHVwZGF0ZSBvbmUgb3IgbW9yZSBkcml2ZXJzIHVzaW5nIE5QTVxuICAgKlxuICAgKiBAcGFyYW0ge0V4dGVuc2lvblVwZGF0ZU9wdHN9IHVwZGF0ZVNwZWNcbiAgICogQHJldHVybiB7RXh0ZW5zaW9uVXBkYXRlUmVzdWx0fVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlICh7ZXh0LCB1bnNhZmV9KSB7XG4gICAgY29uc3Qgc2hvdWxkVXBkYXRlQWxsID0gZXh0ID09PSBVUERBVEVfQUxMO1xuICAgIC8vIGlmIHdlJ3JlIHNwZWNpZmljYWxseSByZXF1ZXN0aW5nIGFuIHVwZGF0ZSBmb3IgYW4gZXh0ZW5zaW9uLCBtYWtlIHN1cmUgaXQncyBpbnN0YWxsZWRcbiAgICBpZiAoIXNob3VsZFVwZGF0ZUFsbCAmJiAhdGhpcy5jb25maWcuaXNJbnN0YWxsZWQoZXh0KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJHt0aGlzLnR5cGV9ICcke2V4dH0nIHdhcyBub3QgaW5zdGFsbGVkLCBzbyBjYW4ndCBiZSB1cGRhdGVkYCk7XG4gICAgfVxuICAgIGNvbnN0IGV4dHNUb1VwZGF0ZSA9IHNob3VsZFVwZGF0ZUFsbCA/IE9iamVjdC5rZXlzKHRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnMpIDogW2V4dF07XG5cbiAgICAvLyAnZXJyb3JzJyB3aWxsIGhhdmUgZXh0IG5hbWVzIGFzIGtleXMgYW5kIGVycm9yIG9iamVjdHMgYXMgdmFsdWVzXG4gICAgY29uc3QgZXJyb3JzID0ge307XG5cbiAgICAvLyAndXBkYXRlcycgd2lsbCBoYXZlIGV4dCBuYW1lcyBhcyBrZXlzIGFuZCB1cGRhdGUgb2JqZWN0cyBhcyB2YWx1ZXMsIHdoZXJlIGFuIHVwZGF0ZVxuICAgIC8vIG9iamVjdCBpcyBvZiB0aGUgZm9ybSB7ZnJvbTogdmVyc2lvblN0cmluZywgdG86IHZlcnNpb25TdHJpbmd9XG4gICAgY29uc3QgdXBkYXRlcyA9IHt9O1xuXG4gICAgZm9yIChjb25zdCBlIG9mIGV4dHNUb1VwZGF0ZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgc3BpbldpdGgodGhpcy5pc0pzb25PdXRwdXQsIGBDaGVja2luZyBpZiAke3RoaXMudHlwZX0gJyR7ZX0nIGlzIHVwZGF0YWJsZWAsICgpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9uc1tlXS5pbnN0YWxsVHlwZSAhPT0gSU5TVEFMTF9UWVBFX05QTSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFVwZGF0YWJsZUVycm9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdXBkYXRlID0gYXdhaXQgc3BpbldpdGgodGhpcy5pc0pzb25PdXRwdXQsIGBDaGVja2luZyBpZiAke3RoaXMudHlwZX0gJyR7ZX0nIG5lZWRzIGFuIHVwZGF0ZWAsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCB1cGRhdGUgPSBhd2FpdCB0aGlzLmNoZWNrRm9yRXh0ZW5zaW9uVXBkYXRlKGUpO1xuICAgICAgICAgIGlmICghKHVwZGF0ZS5zYWZlVXBkYXRlIHx8IHVwZGF0ZS51bnNhZmVVcGRhdGUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTm9VcGRhdGVzQXZhaWxhYmxlRXJyb3IoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHVwZGF0ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghdW5zYWZlICYmICF1cGRhdGUuc2FmZVVwZGF0ZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICR7dGhpcy50eXBlfSAnJHtlfScgaGFzIGEgbWFqb3IgcmV2aXNpb24gdXBkYXRlIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgKCR7dXBkYXRlLmN1cnJlbnR9ID0+ICR7dXBkYXRlLnVuc2FmZVVwZGF0ZX0pLCB3aGljaCBjb3VsZCBpbmNsdWRlIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgYnJlYWtpbmcgY2hhbmdlcy4gSWYgeW91IHdhbnQgdG8gYXBwbHkgdGhpcyB1cGRhdGUsIHJlLXJ1biB3aXRoIC0tdW5zYWZlYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBkYXRlVmVyID0gdW5zYWZlICYmIHVwZGF0ZS51bnNhZmVVcGRhdGUgPyB1cGRhdGUudW5zYWZlVXBkYXRlIDogdXBkYXRlLnNhZmVVcGRhdGU7XG4gICAgICAgIGF3YWl0IHNwaW5XaXRoKFxuICAgICAgICAgIHRoaXMuaXNKc29uT3V0cHV0LFxuICAgICAgICAgIGBVcGRhdGluZyBkcml2ZXIgJyR7ZX0nIGZyb20gJHt1cGRhdGUuY3VycmVudH0gdG8gJHt1cGRhdGVWZXJ9YCxcbiAgICAgICAgICBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLnVwZGF0ZUV4dGVuc2lvbihlLCB1cGRhdGVWZXIpXG4gICAgICAgICk7XG4gICAgICAgIHVwZGF0ZXNbZV0gPSB7ZnJvbTogdXBkYXRlLmN1cnJlbnQsIHRvOiB1cGRhdGVWZXJ9O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGVycm9yc1tlXSA9IGVycjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsICdVcGRhdGUgcmVwb3J0OicpO1xuICAgIGZvciAoY29uc3QgW2UsIHVwZGF0ZV0gb2YgXy50b1BhaXJzKHVwZGF0ZXMpKSB7XG4gICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGAtICR7dGhpcy50eXBlfSAke2V9IHVwZGF0ZWQ6ICR7dXBkYXRlLmZyb219ID0+ICR7dXBkYXRlLnRvfWAuZ3JlZW4pO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtlLCBlcnJdIG9mIF8udG9QYWlycyhlcnJvcnMpKSB7XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgTm90VXBkYXRhYmxlRXJyb3IpIHtcbiAgICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgLSAnJHtlfScgd2FzIG5vdCBpbnN0YWxsZWQgdmlhIG5wbSwgc28gd2UgY291bGQgbm90IGNoZWNrIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBmb3IgdXBkYXRlc2AueWVsbG93KTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyIGluc3RhbmNlb2YgTm9VcGRhdGVzQXZhaWxhYmxlRXJyb3IpIHtcbiAgICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgLSAnJHtlfScgaGFkIG5vIHVwZGF0ZXMgYXZhaWxhYmxlYC55ZWxsb3cpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gb3RoZXJ3aXNlLCBtYWtlIGl0IHBvcCB3aXRoIHJlZCFcbiAgICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgLSAnJHtlfScgZmFpbGVkIHRvIHVwZGF0ZTogJHtlcnJ9YC5yZWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7dXBkYXRlcywgZXJyb3JzfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiBQb3NzaWJsZVVwZGF0ZXNcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGN1cnJlbnQgLSBjdXJyZW50IHZlcnNpb25cbiAgICogQHByb3BlcnR5IHtzdHJpbmd8bnVsbH0gc2FmZVVwZGF0ZSAtIHZlcnNpb24gd2UgY2FuIHNhZmVseSB1cGRhdGUgdG8gaWYgaXQgZXhpc3RzLCBvciBudWxsXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfG51bGx9IHVuc2FmZVVwZGF0ZSAtIHZlcnNpb24gd2UgY2FuIHVuc2FmZWx5IHVwZGF0ZSB0byBpZiBpdCBleGlzdHMsIG9yIG51bGxcbiAgICovXG5cbiAgLyoqXG4gICAqIEdpdmVuIGFuIGV4dGVuc2lvbiBuYW1lLCBmaWd1cmUgb3V0IHdoYXQgaXRzIGhpZ2hlc3QgcG9zc2libGUgdmVyc2lvbiB1cGdyYWRlIGlzLCBhbmQgYWxzbyB0aGVcbiAgICogaGlnaGVzdCBwb3NzaWJsZSBzYWZlIHVwZ3JhZGUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBleHQgLSBuYW1lIG9mIGV4dGVuc2lvblxuICAgKiBAcmV0dXJuIHtQb3NzaWJsZVVwZGF0ZXN9XG4gICAqL1xuICBhc3luYyBjaGVja0ZvckV4dGVuc2lvblVwZGF0ZSAoZXh0KSB7XG4gICAgLy8gVE9ETyBkZWNpZGUgaG93IHdlIHdhbnQgdG8gaGFuZGxlIGJldGEgdmVyc2lvbnM/XG4gICAgLy8gdGhpcyBpcyBhIGhlbHBlciBtZXRob2QsICdleHQnIGlzIGFzc3VtZWQgdG8gYWxyZWFkeSBiZSBpbnN0YWxsZWQgaGVyZSwgYW5kIG9mIHRoZSBucG1cbiAgICAvLyBpbnN0YWxsIHR5cGVcbiAgICBjb25zdCB7dmVyc2lvbiwgcGtnTmFtZX0gPSB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2V4dF07XG4gICAgbGV0IHVuc2FmZVVwZGF0ZSA9IGF3YWl0IHRoaXMubnBtLmdldExhdGVzdFZlcnNpb24ocGtnTmFtZSk7XG4gICAgbGV0IHNhZmVVcGRhdGUgPSBhd2FpdCB0aGlzLm5wbS5nZXRMYXRlc3RTYWZlVXBncmFkZVZlcnNpb24ocGtnTmFtZSwgdmVyc2lvbik7XG4gICAgaWYgKCF1dGlsLmNvbXBhcmVWZXJzaW9ucyh1bnNhZmVVcGRhdGUsICc+JywgdmVyc2lvbikpIHtcbiAgICAgIC8vIHRoZSBsYXRlc3QgdmVyc2lvbiBpcyBub3QgZ3JlYXRlciB0aGFuIHRoZSBjdXJyZW50IHZlcnNpb24sIHNvIHRoZXJlJ3Mgbm8gcG9zc2libGUgdXBkYXRlXG4gICAgICB1bnNhZmVVcGRhdGUgPSBudWxsO1xuICAgICAgc2FmZVVwZGF0ZSA9IG51bGw7XG4gICAgfVxuICAgIGlmICh1bnNhZmVVcGRhdGUgJiYgdW5zYWZlVXBkYXRlID09PSBzYWZlVXBkYXRlKSB7XG4gICAgICAvLyB0aGUgbGF0ZXN0IHVwZGF0ZSBpcyB0aGUgc2FtZSBhcyB0aGUgc2FmZSB1cGRhdGUsIHdoaWNoIG1lYW5zIGl0J3Mgbm90IGFjdHVhbGx5IHVuc2FmZVxuICAgICAgdW5zYWZlVXBkYXRlID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKHNhZmVVcGRhdGUgJiYgIXV0aWwuY29tcGFyZVZlcnNpb25zKHNhZmVVcGRhdGUsICc+JywgdmVyc2lvbikpIHtcbiAgICAgIC8vIGV2ZW4gdGhlIHNhZmUgdXBkYXRlIGlzIG5vdCBsYXRlciB0aGFuIHRoZSBjdXJyZW50LCBzbyBpdCBpcyBub3QgYWN0dWFsbHkgYW4gdXBkYXRlXG4gICAgICBzYWZlVXBkYXRlID0gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHtjdXJyZW50OiB2ZXJzaW9uLCBzYWZlVXBkYXRlLCB1bnNhZmVVcGRhdGV9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFjdHVhbGx5IHVwZGF0ZSBhbiBleHRlbnNpb24gaW5zdGFsbGVkIGJ5IE5QTSwgdXNpbmcgdGhlIE5QTSBjbGkuIEFuZCB1cGRhdGUgdGhlIGluc3RhbGxhdGlvblxuICAgKiBtYW5pZmVzdC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGV4dCAtIG5hbWUgb2YgZXh0ZW5zaW9uIHRvIHVwZGF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbiAtIHZlcnNpb24gc3RyaW5nIGlkZW50aWZpZXIgdG8gdXBkYXRlIGV4dGVuc2lvbiB0b1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlRXh0ZW5zaW9uIChleHQsIHZlcnNpb24pIHtcbiAgICBjb25zdCB7cGtnTmFtZX0gPSB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2V4dF07XG4gICAgYXdhaXQgZnMucmltcmFmKHRoaXMuY29uZmlnLmdldEluc3RhbGxQYXRoKGV4dCkpO1xuICAgIGNvbnN0IGV4dERhdGEgPSBhd2FpdCB0aGlzLmluc3RhbGxWaWFOcG0oe2V4dCwgcGtnTmFtZSwgcGtnVmVyOiB2ZXJzaW9ufSk7XG4gICAgZGVsZXRlIGV4dERhdGFbYCR7dGhpcy50eXBlfU5hbWVgXTtcbiAgICBhd2FpdCB0aGlzLmNvbmZpZy51cGRhdGVFeHRlbnNpb24oZXh0LCBleHREYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiBSdW5PdXRwdXRcbiAgICogQHByb3BlcnR5IHs/c3RyaW5nfHVuZGVmaW5lZH0gZXJyb3IgLSBlcnJvciBtZXNzYWdlIGlmIHNjcmlwdCByYW4gdW5zdWNjZXNzZnVseSwgb3RoZXJ3aXNlIHVuZGVmaW5lZFxuICAgKiBAcHJvcGVydHkge3N0cmluZ1tdfSBvdXRwdXQgLSBzY3JpcHQgb3V0cHV0XG4gICAqL1xuICAvKipcbiAgICogUnVucyBhIHNjcmlwdCBjYWNoZWQgaW5zaWRlIHRoZSBcInNjcmlwdHNcIiBmaWVsZCB1bmRlciBcImFwcGl1bVwiXG4gICAqIGluc2lkZSBvZiB0aGUgZHJpdmVyL3BsdWdpbnMgXCJwYWNrYWdlLmpzb25cIiBmaWxlLiBXaWxsIHRocm93XG4gICAqIGFuIGVycm9yIGlmIHRoZSBkcml2ZXIvcGx1Z2luIGRvZXMgbm90IGNvbnRhaW4gYSBcInNjcmlwdHNcIiBmaWVsZFxuICAgKiB1bmRlcm5lYXRoIHRoZSBcImFwcGl1bVwiIGZpZWxkIGluIGl0cyBwYWNrYWdlLmpzb24sIGlmIHRoZVxuICAgKiBcInNjcmlwdHNcIiBmaWVsZCBpcyBub3QgYSBwbGFpbiBvYmplY3QsIG9yIGlmIHRoZSBzY3JpcHROYW1lIGlzXG4gICAqIG5vdCBmb3VuZCB3aXRoaW4gXCJzY3JpcHRzXCIgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXh0IC0gbmFtZSBvZiB0aGUgZXh0ZW5zaW9uIHRvIHJ1biBhIHNjcmlwdCBmcm9tXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzY3JpcHROYW1lIC0gbmFtZSBvZiB0aGUgc2NyaXB0IHRvIHJ1blxuICAgKiBAcmV0dXJuIHtSdW5PdXRwdXR9XG4gICAqL1xuICBhc3luYyBydW4gKHtleHQsIHNjcmlwdE5hbWV9KSB7XG4gICAgaWYgKCFfLmhhcyh0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zLCBleHQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsZWFzZSBpbnN0YWxsIHRoZSAke3RoaXMudHlwZX0gZmlyc3RgKTtcbiAgICB9XG5cbiAgICBjb25zdCBleHRDb25maWcgPSB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2V4dF07XG5cbiAgICBpZiAoIV8uaGFzKGV4dENvbmZpZywgJ3NjcmlwdHMnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJHt0aGlzLnR5cGV9IG5hbWVkICcke2V4dH0nIGRvZXMgbm90IGNvbnRhaW4gdGhlIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBcInNjcmlwdHNcIiBmaWVsZCB1bmRlcm5lYXRoIHRoZSBcImFwcGl1bVwiIGZpZWxkIGluIGl0cyBwYWNrYWdlLmpzb25gKTtcbiAgICB9XG5cbiAgICBjb25zdCBleHRTY3JpcHRzID0gZXh0Q29uZmlnLnNjcmlwdHM7XG5cbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChleHRTY3JpcHRzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJHt0aGlzLnR5cGV9IG5hbWVkICcke2V4dH0nIFwic2NyaXB0c1wiIGZpZWxkIG11c3QgYmUgYSBwbGFpbiBvYmplY3RgKTtcbiAgICB9XG5cbiAgICBpZiAoIV8uaGFzKGV4dFNjcmlwdHMsIHNjcmlwdE5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAke3RoaXMudHlwZX0gbmFtZWQgJyR7ZXh0fScgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc2NyaXB0OiAnJHtzY3JpcHROYW1lfSdgKTtcbiAgICB9XG5cbiAgICBjb25zdCBydW5uZXIgPSBuZXcgU3ViUHJvY2Vzcyhwcm9jZXNzLmV4ZWNQYXRoLCBbZXh0U2NyaXB0c1tzY3JpcHROYW1lXV0sIHtcbiAgICAgIGN3ZDogdGhpcy5jb25maWcuZ2V0RXh0ZW5zaW9uUmVxdWlyZVBhdGgoZXh0KVxuICAgIH0pO1xuXG4gICAgY29uc3Qgb3V0cHV0ID0gbmV3IFJpbmdCdWZmZXIoNTApO1xuXG4gICAgcnVubmVyLm9uKCdzdHJlYW0tbGluZScsIChsaW5lKSA9PiB7XG4gICAgICBvdXRwdXQuZW5xdWV1ZShsaW5lKTtcbiAgICAgIGxvZyh0aGlzLmlzSnNvbk91dHB1dCwgbGluZSk7XG4gICAgfSk7XG5cbiAgICBhd2FpdCBydW5uZXIuc3RhcnQoMCk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgcnVubmVyLmpvaW4oKTtcbiAgICAgIGxvZyh0aGlzLmlzSnNvbk91dHB1dCwgYCR7c2NyaXB0TmFtZX0gc3VjY2Vzc2Z1bHkgcmFuYC5ncmVlbik7XG4gICAgICByZXR1cm4ge291dHB1dDogb3V0cHV0LmdldEJ1ZmYoKX07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2codGhpcy5pc0pzb25PdXRwdXQsIGBFbmNvdW50ZXJlZCBhbiBlcnJvciB3aGVuIHJ1bm5pbmcgJyR7c2NyaXB0TmFtZX0nOiAke2Vyci5tZXNzYWdlfWAucmVkKTtcbiAgICAgIHJldHVybiB7ZXJyb3I6IGVyci5tZXNzYWdlLCBvdXRwdXQ6IG91dHB1dC5nZXRCdWZmKCl9O1xuICAgIH1cbiAgfVxufVxuIl0sImZpbGUiOiJsaWIvY2xpL2V4dGVuc2lvbi1jb21tYW5kLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
